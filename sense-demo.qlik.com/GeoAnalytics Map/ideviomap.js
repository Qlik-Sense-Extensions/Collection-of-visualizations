define(["./properties","../IdevioMap/common/Utils","./Map","./settings","css!./style.css","../IdevioMap/common/extraTools"],function(b,d,a,c){return{initialProperties:{title:"GeoAnalytics Map",showTitles:false,server:c.server||"https://maps.qlikcloud.com",version:"0.1",debug:true,showScaleBar:true,showLabels:true,mapId:null,mapOptions:{baseMap:"default",gl:false,center:[30,0],zoomLevel:2,highlight:"rgba(200,50,100,0.5)",tools:[],debug:{}}},snapshot:{canTakeSnapshot:true},definition:b,on:function(){var e=this.mapLayer||this;e.editMode=false;this._on=true},off:function(){var e=this.mapLayer||this;e.editMode=true;this._on=false},resize:function(){if(this.mapLayer&&this.mapLayer.map){this.mapLayer.map.repaint()}},paint:function(e,f){var g=this;if(!this.mapLayer){if(f.qInfo.qType!=="masterobject"&&Boolean(d.maps[f.mapId])){if(!this.isUpdatingMapId){this.isUpdatingMapId=true;this.backendApi.getProperties().then(function(h){h.mapId=d.getNewMapId();g.backendApi.setProperties(h);g.backendApi.save();g.isUpdatingMapId=false})}return}this.mapLayer=new a(f.qInfo.qId);this.mapLayer.editMode=this.editMode;d.mapApi[f.qInfo.qId]=this.backendApi;this.destroy=function(){if(d.getValue(this.mapLayer,"properties.qInfo.qType")==="masterobject"){var i=d.getValue(this.mapLayer,"properties.realMapId");if(typeof i!=="undefined"&&!this.options.isPopover){delete d.maps[i]}}for(var h in d.maps){if(d.maps[h]===g.mapLayer){delete d.maps[h];break}}if(this.mapLayer){this.mapLayer.repaintExtensions()}}}if(f.mapId){this.mapLayer.paintLayer(e,f,this)}else{this.backendApi.getProperties().then(function(h){if(!h.hasOwnProperty("server")){h=f}if(!h.mapId||h.mapId==="0"){h.mapId=d.getNewMapId();g.backendApi.setProperties(h);g.backendApi.save()}g.mapLayer.paintLayer(e,h,g)})}}}});