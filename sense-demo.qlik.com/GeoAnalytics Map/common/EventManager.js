define(["./Utils","./QvUtils","./LegendManager","./ColorManager","./LocationManager"],function(h,l,a,b,k){var d="Server";function g(q){var p=q.parents("[id^=SRVPROPS]");if(p.length===0){p=q.parents("[id^=DOCPROPS]")}return p[0].id.match(/\\[^\.]+/)[0].replace("\\",d)}function o(q,s,r,t,u){var v=g(q);var p=(u)?h.mapsToInitiate[v]:h.layers[v].extension;p.Layout.SetProperty(s,r,true||!!t)}function c(p,q,r,s){var t=p.attr("avq").replace(/^[^:]+:./,"");o(p,t,q,r,s)}function j(p,q){p.forEach(function(s){var r=$(s);if(r.prop("type")==="checkbox"){r.parent().parent().parent().toggle(q);r.parent().parent().parent().next().toggle(q)}else{if(r.parent().parent().prev().length!==0){r.parent().parent().toggle(q);r.parent().parent().prev().toggle(q)}else{r.parent().parent().parent().toggle(q);r.parent().parent().parent().prev().toggle(q)}}})}function i(r,p){for(var q=0;q<r.length;q++){$(r[q]).prop("disabled",!p)}}function f(p,q){p.forEach(function(s){var r=s.parent().parent();r.toggle(q);r.prev().toggle(q)})}function n(v,t,s){var q;if(t.find("#"+v).length<1){q=$("<div>",{id:v}).addClass("prop-grid_vertical_align").css("width","192px");var u=$("<input>",{type:"text"}).addClass("prop-expression-input").css("width","186px").attr("disabled","true");var p=$("<span>").attr("propicontype","expression");var r=$("<button>").addClass("prop-icon-24x24 prop-icon-expression prop-grid_button prop-expression-button");p.append(r);u.val(s);q.append(u);q.append(p)}else{q=t.find("#"+v);q.find("input").val(s)}return q}function e(p,r){if(!p){return}var q={type:"load",target:p};if(r.constructor===Array){r.forEach(function(s){eventHandler(q,s)})}else{eventHandler(q,r)}}var m={propsLoaded:function(q,r){var p;if(h.layers[r]&&h.layers[r].extension.Layout){p=h.layers[r].extension.Layout}else{if(h.mapsToInitiate[r]&&h.mapsToInitiate[r].Layout){p=h.mapsToInitiate[r].Layout}}l.fixPropertiesValues(p)},geoPropsLoaded:function(s,t){if(!s.noPropsLoaded){this.propsLoaded(s,t)}var r=$(s.target).parent();var q=r.find("[name='gmlSettingGeoName']").first();q.parents("[data-load]").first().removeAttr("data-load");var p=r.find("[name='wmsSettingWmsVersion']").first();p.parents("[data-load]").first().removeAttr("data-load");e($("[name='drawOrderAuto']").first()[0],"drawOrderChanged");e(q[0],"gmlSettingsChanged");e(p[0],"wmsSettingsChanged")},mapPropsLoaded:function(s,t){if(!s.noPropsLoaded){this.propsLoaded(s,t)}var r=$(s.target).parent();var q=r.find("div[name=zoomToSelection] input");var p=r.find("div[name=saveViewArea] button");p.prop("disabled",q.prop("checked"));l.runLoadEvents()},baseMap:function(u,w){var p=h.mapsToInitiate[w];if(/load/i.test(u.type)){var t=$(u.target).parent();var r=$("select[name=baseMap]",t).empty();h.getLoadedMapsOptions().forEach(function(x){$("<option>").attr("value",x.value).text(x.label).appendTo(r)});var q=h.getValue(p,"mapLayer.properties.mapOptions.baseMap");if(q){r.val(q)}}else{var v=u.srcElement.getAttribute("avq").replace("mySelect:.","");var s=u.target.value;p.Layout.SetProperty(v,s,true)}},showLabels:function(r,s){var p=r.target.checked;var q=h.mapsToInitiate[s].mapLayer.map;q.getLayer("Background Labels").setVisible(p);q.repaint()},allowPanning:function(r,s){var q=r.target.checked;var p=h.mapsToInitiate[s].mapLayer;if(q){p.tools.panTool.connectTo(p.map)}else{p.tools.panTool.disconnect()}},allowZooming:function(r,s){var q=r.target.checked;var p=h.mapsToInitiate[s].mapLayer;if(q){p.tools.zoomTool.connectTo(p.map)}else{p.tools.zoomTool.disconnect()}},zoomInResLimit:function(r,s){var p=r.target.value;var q=h.mapsToInitiate[s].mapLayer.map;if(q.setMaxLevel){q.setMaxLevel(h.getClosestMaxZoomLevel(p,q));q.repaint()}},zoomOutResLimit:function(r,s){var p=r.target.value;var q=h.mapsToInitiate[s].mapLayer.map;if(q.setMinLevel){q.setMinLevel(h.getClosestMinZoomLevel(p,q));q.repaint()}},selectTool:function(r,t){var s=r.srcElement.getAttribute("avq").replace("mySelect:.","");var q=r.target.value;var p=h.mapsToInitiate[t];p.mapLayer.tools.boxSelectTool.setType(q);p.Layout.SetProperty(s,q,true)},showScaleBar:function(t,v){var r=t.target.checked;var p=h.mapsToInitiate[v].mapLayer;var q=$(t.target);var s=q.parents(".ui-widget-content").first();var u=s.find("div[name=imperialUnitsScaleBar] input");u.prop("disabled",!r);if(r){p.tools.scaleBar.connectTo(p.map)}else{p.tools.scaleBar.disconnect()}},imperialUnitsScaleBar:function(r,s){var q=r.target.checked;var p=h.mapsToInitiate[s].mapLayer;p.tools.scaleBar._useImperial=q;p.tools.scaleBar._show()},showLayerControls:function(p,q){h.mapsToInitiate[q].mapLayer.LayerListEnabled=!h.mapsToInitiate[q].mapLayer.LayerListEnabled;h.mapsToInitiate[q].mapLayer.showLayerList()},showZoomControls:function(q,r){var p=q.target.checked;h.mapsToInitiate[r].mapLayer.showZoomButtons({showZoomButtons:p})},showErrorMessages:function(q,r){var p=q.target.checked;h.mapsToInitiate[r].mapLayer.logger.toggleList({showErrorList:p})},showDebugInfo:function(r,s){var q=r.target.checked;var p=h.mapsToInitiate[s].mapLayer;p.tools.debugLayer.setVisible(q)},logLevel:function(r,t){var s=r.srcElement.getAttribute("avq").replace("mySelect:.","");var q=r.target.value;var p=h.mapsToInitiate[t];p.mapLayer.logLevel=q;p.Layout.SetProperty(s,q,true);p.mapLayer.logger.showErrors()},zoomToSelection:function(s,t){var q=$(s.target);var r=q.parents(".ui-widget-content").first();var p=r.find("div[name=saveViewArea] button");p.prop("disabled",q.prop("checked"))},saveViewArea:function(p,q){h.mapsToInitiate[q].mapLayer.storeViewBounds()},labelPositionChanged:function(r,s){var q=r.target.value;var p=h.layers[s].extension;p.Layout.SetProperty("Chart.Text.41.Content",q,true)},sizeChanged:function(x){var r=$(x.target);var C=r.parents(".ui-widget-content").first();var z=C.find("div[name=shapeselection] select");var p=C.find("div[name=barswidth] input");var v=C.find("div[name=minRadius] input");var t=C.find("div[name=maxRadius] input");var B=C.find("div[name=minHeight] input");var A=C.find("div[name=maxHeight] input");var D=C.find("div[name=minSizeValue] input");var q=C.find("div[name=maxSizeValue] input");var s=C.find("div[name=symbolUrl] div");var w=C.find("div[name=symbolScale] div");var u=C.find("div[name=symbolRotation] div");var y=z.val();if(y==="bars"){f([v,t,s,w,u],false);f([p,B,A,D,q],true)}else{if(y==="symbols"){f([p,v,t,B,A,D,q],false);f([s,w,u],true)}else{f([p,B,A,s,w,u],false);f([v,t,D,q],true)}}switch(r[0]){case z[0]:c(z,z.val());break;case v[0]:c(v.parent(),v.val());break;case t[0]:c(t.parent(),t.val());break;case B[0]:c(B.parent(),B.val());break;case A[0]:c(A.parent(),A.val());break;case D[0]:c(D.parent(),D.val());break;case q[0]:c(q.parent(),q.val());break;case p[0]:c(p.parent(),p.val());break}},chartTypeChanged:function(y){var t=$(y.target);var z=t.parents(".ui-widget-content").first();var u=z.find("div[name=chartType] select");var s=z.find("div[name=chartRadius] input");var q=z.find("div[name=chartWidth] input");var x=z.find("div[name=chartHeight] input");var r=z.find("div[name=chartValueLabel] input");var p=z.find("div[name=chartDimensionLabel] input");var w=u.val();var v=w==="bar";q.parent().parent().toggle(v);q.parent().parent().prev().toggle(v);x.parent().parent().toggle(v);x.parent().parent().prev().toggle(v);s.parent().parent().toggle(!v);s.parent().parent().prev().toggle(!v);switch(t[0]){case u[0]:c(u,u.val());break;case s[0]:c(s.parent(),s.val());break;case q[0]:c(q.parent(),q.val());break;case x[0]:c(x.parent(),x.val());break;case r[0]:c(r.parent(),r.val());break;case p[0]:c(p.parent(),p.val());break}},sourceFormat:function(y,s){var t=$(y.target);var z=t.parents(".ui-widget-content").first();var q=z.find("div[name=geodataSourceFormat] select");var r=z.find("div[name=geodataSourceURL] input");var D=z.find("div[name=geodataTileURL] input");var p=z.find("div[name=loadViaServer] input");var x=z.find("div[name=geodataStyles] input");var C=z.find("div[name=geodataTileSize] input");var v=z.find("div[name=wmsSettings]");var w=z.find("div[name=gmlSettings]");var u=[z.find("div[name=advTmsSettingAuto] input"),z.find("div[name=advTmsSettingWidth] input"),z.find("div[name=advTmsSettingHeight] input"),z.find("div[name=advTmsSettingLeft] input"),z.find("div[name=advTmsSettingTop] input")];var B=h.layers[s];var A=q.val();if(A==="FILE_GEOJSON"){v.hide();w.hide();j([C,D].concat(u),false);j([x,r,p],true)}else{if(A==="FILE_GML"){v.hide();j([C,D].concat(u),false);w.show();j([x,r,p],true)}else{if(A==="TILES_WMS"){w.hide();j([C,x,r].concat(u),false);v.show();p.show();j([D],true)}else{if(A==="TILES_IDEVIO"){v.hide();w.hide();j([x,r,p].concat(u),false);j([C,D],true)}else{if(A==="TILES_TMS"){v.hide();w.hide();j([x,r,p],false);j([C,D].concat(u),true)}}}}}if(!/load/i.test(y.type)){switch(t[0]){case q[0]:B.clearLayer(true);c(q,q.val());break}}},styles:function(q,s){var p=q.target.value;var r=h.layers[s];if(!r||!r.layer){return}if(p!==""){r.layer.setStyles(h.parseStyles(p))}else{r.layer.setStyles([])}},advTmsSettingsChanged:function(r){var p=$(r.target);var u=p.parents(".ui-widget-content").first();var v=u.find("div[name=advTmsSettingAuto] input");var t=u.find("div[name=advTmsSettingWidth] input");var q=u.find("div[name=advTmsSettingHeight] input");var s=u.find("div[name=advTmsSettingLeft] input");var w=u.find("div[name=advTmsSettingTop] input");var x=v.prop("checked");t.prop("disabled",x);q.prop("disabled",x);s.prop("disabled",x);w.prop("disabled",x);if(t[0]===p[0]){c(t.parent(),t.val())}else{if(q[0]===p[0]){c(q.parent(),q.val())}else{if(s[0]===p[0]){c(s.parent(),s.val())}else{if(w[0]===p[0]){c(w.parent(),w.val())}}}}},gmlSettingsChanged:function(v,q){var u=h.layers[q];if(!u){return}var r=$(v.target);var w=r.parents(".ui-widget-content").first();var s=w.find("div[name=gmlSettingGeoName] input");var p=w.find("div[name=gmlSettingReverse] input");var t=u.extension.propertyMapping.geodataOptions;var x=JSON.parse(u.extension.Layout["Text"+t].text||"{}")||{};if(/load/i.test(v.type)){x.gml=x.gml||{};s.val(x.gml.geoName||"the_geom");p.prop("checked",x.gml.reverse||false)}else{x.gml={geoName:s.val(),reverse:p.prop("checked")};o(w,"Chart.Text."+t+".Content",JSON.stringify(x))}},wmsSettingsChanged:function(v,q){var u=h.layers[q];if(!u){return}var r=$(v.target);var w=r.parents(".ui-widget-content").first();var p=w.find("div[name=wmsSettingWmsVersion] select");var x=w.find("div[name=wmsSettingBuffer] input");var t=w.find("div[name=wmsSettingCRS] input");var s=u.extension.propertyMapping.geodataOptions;var y=JSON.parse(u.extension.Layout["Text"+s].text||"{}")||{};if(/load/i.test(v.type)){y.wms=y.wms||{};p.val(y.wms.version||"1.3.0");x.val(y.wms.buffer||"30");t.val(y.wms.crs||"EPSG:4326")}else{y.wms={version:p.val(),buffer:x.val(),crs:t.val()};o(w,"Chart.Text."+s+".Content",JSON.stringify(y))}},layerInit:function(q){var p=$(q.target).parent().next();e(p.find("[name='drawOrderAuto']").first()[0],"drawOrderChanged")},locationInit:function(v){var u=$(v.target).parent().next();var s=u.find("[name=locationSuffixList]");var w=s.first();var p=s.last();if(w.children().length===0){for(var r=0;r<k.countryCodes.length;r++){var q=k.countryCodes[r];$("<option>",{value:q.value}).text(q.label).appendTo(w)}for(r=0;r<k.locationTypes.length;r++){var t=k.locationTypes[r];$("<option>",{value:t.value}).text(t.label).appendTo(p)}}e(u.find("[name='locService']").first()[0],"locationServiceChanged");e(u.find("div[name=advancedLocation] input").first()[0],"advancedLocation")},colorInit:function(q){var p=$(q.target).parent().next();e(p.find("[name='preview']").first()[0],"colorSettingChanged")},heatmapInit:function(q){var p=$(q.target).parent().next();e(p.find("[name='heatmapTransparency']").first()[0],["heatmapRadiusChanged","autoScaleWeightFactor","heatmapColors"])},geodataInit:function(q){var p=$(q.target).parent().next();e(p.find("[name='advTmsSettingAuto']").first()[0],"advTmsSettingsChanged")},legendInit:function(q){var p=$(q.target).parent().next();e(p.find("[name='colorLegendAuto']").first()[0],"colorLegendAuto");e(p.find("[name='sizeLegendAuto']").first()[0],"sizeLegendAuto");e(p.find("[name='showLegendIconTitle']").first()[0],"showLegendIconTitle")},controlsInit:function(q){var p=$(q.target).parent().next();e(p.find("[name='showScaleBar'] input").first()[0],"showScaleBar")},labelInit:function(q){var p=$(q.target).parent().next();e(p.find("[name='showLabel']").first()[0],"showLabelChanged")},infoBubbleInit:function(q){var p=$(q.target).parent().next();e(p.find("[name='showInfoBubble']").first()[0],"showInfoBubbleChanged")},sizeInit:function(q){var p=$(q.target).parent().next();e(p.find("[name='minRadius']").first()[0],"sizeChanged")},chartPresentationInit:function(q){var p=$(q.target).parent().next();e(p.find("[name='chartType']").first()[0],"chartTypeChanged")},mapId:function(v,w){var u=$(v.target);var t=h.layers[w];if(!t){return}if(v.type==="load"){var s=t.extension.propertyMapping.mapid;var r=t.extension.Layout["Text"+s].text;var q=h.maps[r];u.append(new Option((q?q.properties.title+" ":"")+"("+r+")",r));u.val(r);u.on("mousedown",function(){var A=$(this);if(!A.is(":focus")){var y=A.val();A.children().remove();for(var x in h.maps){if(h.maps.hasOwnProperty(x)){var z=h.maps[x];A.append(new Option((z?z.properties.title+" ":"")+"("+x+")",x))}}A.val(y)}});return}if(v.type==="click"&&Object.keys(h.maps).length>1){return}var p=u.val();c(u,p);t.layout.mapid=p;t.setMap(h.maps[p])},inResolutionLimit:function(q,s){var p=parseInt(q.target.value,10);var r=h.layers[s];if(r&&r.layer){r.layer.setMinRes(p)}},outResolutionLimit:function(q,s){var p=parseInt(q.target.value,10);var r=h.layers[s];if(r&&r.layer){r.layer.setMaxRes(p)}},drawOrderChanged:function(w,q){var r=$(w.target);var y=r.parents(".ui-widget-content").first();var A=y.find("div[name =drawOrderAuto] input");var v=y.find("div[name =drawOrderCategory] select");var x=y.find("div[name =drawOrderAdjustment] input");var u=A.prop("checked");v.prop("disabled",u);x.prop("disabled",u);var t=h.layers[q].layer;if(t&&t.setDrawOrder){if(u){var s="idevio"+(h.layers[q].name.replace(" ","").toLowerCase());t.setDrawOrder(h.DRAW_ORDER_TABLE[s])}else{var z=Math.max(-10,Math.min(10,x.val()));var p=v.val();t.setDrawOrder(h.DRAW_ORDER_TABLE[p]+z)}}if(A[0]===r[0]){c(A,A.prop("checked")?1:0)}else{if(v[0]===r[0]){c(v,v.val())}else{if(x[0]===r[0]){c(x.parent(),x.val())}}}},includeInAutoZoom:function(s){var p=$(s.target);var r=p.parents(".ui-widget-content").first();var q=r.find("div[name=includeInAutoZoom] input");if(q[0]===p[0]){c(q,q.prop("checked")?1:0)}},locationServiceChanged:function(J){var s=$(J.target);var w=s.parents(".ui-widget-content").first();var K=w.find("div[name=locService] input");var I=w.find("div[name=locServiceType] select");var F=w.find("[name=viaServer] input");var M=w.find("[name=locationSuffixList]");var B=w.find("[name=locationSuffixListsDiv]");var G=w.find("[name=forceFileReload] input");var v=w.find("[name=advancedLocation] input");var r=M.first();var D=M.last();var u=w.find("div[name=locIdSuffix] input");var L=w.find("div[name=sourceKeyAtt] input");var q=w.find("div[name=manRemap] input");var H=w.find("[name=gmlOptions]");var A=I.val();var z=/^file/i.test(A);var O=/gml$/i.test(A);var C=v.prop("checked");f([u],!z&&C);f([L],z);B.toggle(!z&&!C);G.parent().parent().parent().toggle(z);G.parent().parent().parent().next().toggle(z);v.parent().parent().parent().toggle(!z);v.parent().parent().parent().next().toggle(!z);H.toggle(O);switch(s[0]){case I[0]:c(I,I.val());break;case K[0]:c(K.parent(),K.val());break;case L[0]:c(L.parent(),L.val());break;case u[0]:c(u.parent(),u.val());break;case q[0]:c(q.parent(),q.val());break;case F[0]:c(F,F.prop("checked")?1:0);break}var x=u.val()||"";var t=x.match(/^,([a-z]+)/i);var y=x.match(/:(.+)$/i);t=(t)?t[1].toUpperCase():"";y=(y)?y[1].toUpperCase():"";var N=false;var p=false;var E;if(y){for(E=0;E<k.locationTypes.length;E++){if(k.locationTypes[E].value===y){N=true;break}}}if(t&&N){for(E=0;E<k.countryCodes.length;E++){if(k.countryCodes[E].value===t){p=true;break}}}r.val(t);D.val(y);if(x&&(!p||!N)){v.prop("checked",true)}},advancedLocation:function(s){var r=$(s.target).parent().parent().parent().parent();var p=r.find("[name=locationSuffixList]");var q=r.find("div[name=locIdSuffix] input");var t=$(s.target).prop("checked");f([p],!t);f([q],t)},gmlLocSettingsChanged:function(v,q){var u=h.layers[q];if(!u){return}var r=$(v.target);var w=r.parents(".ui-widget-content").first();var s=w.find("div[name=gmlLocSettingGeoName] input");var p=w.find("div[name=gmlLocSettingReverse] input");var t=u.extension.propertyMapping.gmlOptions;var y;if(/load/i.test(v.type)){y=l.getStoredObject(u.extension,t,{});s.val(y.geoName||"the_geom");p.prop("checked",y.reverse||false)}else{y={geoName:s.val(),reverse:p.prop("checked")};var x=h.layers[q];if(x){x.clearLayer(true);x.cachedDatasets={}}o(w,"Chart.Text."+t+".Content",JSON.stringify(y))}},locationSuffixListsChanged:function(v){var t=$(v.target).parent().parent().parent().parent();var q=t.find("[name=locationSuffixList]");var s=t.find("div[name=locIdSuffix] input");var p=q.first().val();var r=q.last().val();var u="";if(p){u+=","+p}if(r){u+=":"+r}s.val(u);c(s.parent(),u)},heatmapRadiusChanged:function(v,q){var x=h.layers[q];if(!x||!x.layer){return}var r=$(v.target);var y=r.parents(".ui-widget-content").first();var w=y.find("div[name=heatmapTransparency] input");var s=y.find("div[name=heatmapRadiusUnit] select");var p=y.find("div[name=heatmapRadius] input");var z=s.val();var u=parseInt(p.val());var t=Math.max(0,Math.min(100,parseInt(w.val())));if(z==="pixels"){if(u>500){u=50;x.layer.setRadius(u);c(p.parent(),u)}}if(z==="meters"){if(u>10000000){u=1000000;x.layer.setRadius(u);c(p.parent(),u)}}switch(r[0]){case s[0]:x.layer.setRadiusUnit(z);c(s,z);break;case p[0]:x.layer.setRadius(u);c(p.parent(),u);break;case w[0]:x.layer.setAlpha((100-t)/100);c(w.parent(),t);break}},autoScaleWeightFactor:function(u,p){var w=h.layers[p];if(!w||!w.layer){return}var q=$(u.target);var r=q.parents(".ui-widget-content").first();var t=r.find("div[name=weightfactor] input");var s=r.find("div[name=autoscale] input");var x=s.prop("checked");var v=parseFloat(t.val());w.layer.setAutoScale(x);i(t,!x);w.layer.setCommonWeight((x)?1:v);switch(q[0]){case s[0]:c(s,s.prop("checked")?1:0);break;case t[0]:c(t.parent(),t.val());break}},heatmapColors:function(v,s){var z=h.layers[s];if(!z||!z.layer){return}var t=$(v.target);var C=t.parents(".ui-widget-content").first();var q=C.find("div[name=defaultcolors] input");var w=C.find("div[name=heatmapcolors] input");var r=C.find("div[name=heatmapcolordist] input");var B=q.prop("checked");var p=w.val();var y=r.val();var u=["rgba(0,0,0,0)","rgba(5,5,85,0.5)","rgba(0,234,242,0.65)","rgba(0,180,65,0.65)","rgba(220,252,5,0.65)","rgba(255,1,1,0.65)","rgba(255,237,237,0.65)"];var A=[0,0.15,0.3,0.45,0.6,0.8,1];i([w,r],!B);if(B){z.layer.setColors(u);z.layer.setColorDistribution(A)}else{if(p){try{z.layer.setColors(b.splitStringIntoColors(p))}catch(x){z.addError("HeatmapLayer","Invalid color array")}}if(y){try{z.layer.setColorDistribution(y.split(",").map(Number))}catch(x){z.addError("HeatmapLayer","Invalid color distribution")}}}switch(t[0]){case q[0]:c(q,q.prop("checked")?1:0);break;case w[0]:c(w.parent(),w.val());break;case r[0]:c(r.parent(),r.val());break}},arrowStyle:function(r,s){var q=r.target.value;var p=h.layers[s];if(p){p.extension.Layout.SetProperty("Chart.Text.31.Content",q,true)}},colorLegendAuto:function(t){var p=$(t.target);var v=p.parents(".ui-widget-content").first();var x=v.find("div[name=colorLegendAuto] input");var w=v.find("div[name=showColors] input");var u=v.find("div[name=showColorValues] input");var y=v.find("div[name=showColorTitle] input");var s=v.find("div[name=colorTitleExpression]");var z=s.find("input");var r=x.prop("checked");var q=n("colorLegendAuto",v,z.val());if(r&&s.parent().find(q).length<1){s.parent().append(q);q.find("input").css("width",z.css("width"))}z.parent().parent().toggle(!r);q.toggle(r);w.prop("disabled",r);u.prop("disabled",r);y.prop("disabled",r);switch(p[0]){case w[0]:c(w,w.prop("checked")?1:0);break;case u[0]:c(u,u.prop("checked")?1:0);break;case y[0]:c(y,y.prop("checked")?1:0);break;case x[0]:c(x,x.prop("checked")?1:0);break}},sizeLegendAuto:function(y){var p=$(y.target);var z=p.parents(".ui-widget-content").first();var t=z.find("div[name=sizeLegendAuto] input");var s=z.find("div[name=showSizes] input");var w=z.find("div[name=showSizeValues] input");var x=z.find("div[name=showSizeTitle] input");var r=z.find("div[name=sizeTitleExpression]");var v=r.find("input");var u=t.prop("checked");var q=n("sizeLegendAuto",z,v.val());if(u&&r.parent().find(q).length<1){r.parent().append(q)}v.parent().parent().toggle(!u);q.toggle(u);s.prop("disabled",u);w.prop("disabled",u);x.prop("disabled",u);switch(p[0]){case s[0]:c(s,s.prop("checked")?1:0);break;case w[0]:c(w,w.prop("checked")?1:0);break;case x[0]:c(x,x.prop("checked")?1:0);break;case t[0]:c(t,t.prop("checked")?1:0);break}},showLegendIconTitle:function(v){var q=$(v.target);var u=q.parents(".ui-widget-content").first();var t=u.find("div[name=iconTitleExpression]");var s=t.find("input");var p=u.find("div[name=showLegendIconTitle] input").prop("checked");var r=n("iconTitleExpression",u,s.val());if(!p&&t.parent().find(r).length<1){t.parent().append(r);r.find("input").css("width",s.css("width"))}s.parent().parent().toggle(p);r.toggle(!p)},showLabelResolutionLimitChanged:function(r,t){var s=$(r.srcElement).parent()[0].getAttribute("avq").replace("myEditinput:.","");var q=r.target.value;var p=h.layers[t];if(p){p.extension.Layout.SetProperty(s,q,true)}},showLabelChanged:function(u){var r=$(u.target);var t=r.parents(".ui-widget-content").first();var q=t.find("div[name=showLabel] input");var x=t.find("div[name=showLabelExpression]");var v=t.find("div[name=showLabelExpression] input");var p=t.find("div[name=showLabelResolutionLimit] input");var w=t.find("div[name=showLabelPosition] select");var z=q.prop("checked");var y=v.val();var s=n("showLabelChanged",t,y);if(!z&&x.parent().find(s).length<1){x.parent().append(s)}v.parent().parent().toggle(z);s.toggle(!z);p.prop("disabled",!z);w.prop("disabled",!z)},showInfoBubbleChanged:function(D){var p=$(D.target);var B=p.parents(".ui-widget-content").first();var r=B.find("div[name=showInfoBubble] input");var w=B.find("div[name=showInfoBubbleAuto] input");var G=B.find("div[name=showInfoBubbleExpression]");var C=B.find("div[name=showInfoBubbleExpression] input");var q=B.find("div[name=showInfoBubbleMaxColumnWidth] input");var A=B.find("div[name=showInfoBubbleFormatNumbers] input");var y=B.find("div[name=showInfoBubbleFormatAuto] input");var E=B.find("div[name=showInfoBubbleFormatList] input");var t=r.prop("checked");var x=w.prop("checked");var z=A.prop("checked");var F=y.prop("checked");var u=Math.min(500,Math.max(0,q.val()));var s=C.val();var v=n("showInfoBubbleChanged",B,s);if((!t||x)&&G.parent().find(v).length<1){G.parent().append(v)}C.parent().parent().toggle(t&&!x);v.toggle(!t||x);w.prop("disabled",!t);A.prop("disabled",!t);y.prop("disabled",!t||!z);E.prop("disabled",!t||!z||F);if(w[0]===p[0]){c(w,w.prop("checked")?1:0)}else{if(A[0]===p[0]){c(A,A.prop("checked")?1:0)}else{if(q[0]===p[0]){c(q.parent(),u)}else{if(y[0]===p[0]){c(y,y.prop("checked")?1:0)}else{if(E[0]===p[0]){c(E.parent(),E.val())}}}}}},colorSettingChanged:function(M){function r(V,W,X){var U=V.parents("[id^=SRVPROPS]");if(U.length===0){U=V.parents("[id^=DOCPROPS]")}var Z=U[0].id.match(/\\[^\.]+/)[0].replace("\\",d);var Y=V.attr("avq").replace(/^[^:]+:./,"");h.layers[Z].extension.Layout.SetProperty(Y,W,true||!!X)}var p=$(M.target);var T=p.parents(".ui-widget-content").first();var z=T.find("div[name=auto] input");var C=T.find("div[name=preview] > div");var F=T.find("div[name=scheme] select");var I=T.find("div[name=mode] select");var s=T.find("div[name=colorexpression] div");var P=T.find("div[name=reverse] input");var w=T.find("div[name=rangeAuto] input");var q=T.find("div[name=rangeMin] input");var t=T.find("div[name=rangeMax] input");var G=T.find("div[name=transparency] input");var N=T.find("div[name=outlineColor] input");var L=F.find("option");var S=L.filter("[value="+F.val()+"]");var B=I.val();var K=B==="byExpression";var v=z.prop("checked");var R=w.prop("checked");if(document.documentMode<12){L.filter("span > option").unwrap();L.filter(":not([cmode="+B+"])").wrap("<span>").parent().hide()}else{L.filter("[cmode="+B+"]").show();L.filter(":not([cmode="+B+"])").hide()}if(S.attr("cmode")!==B&&(B!=="byExpression")){var Q=L.filter("[cmode="+B+"]").first();F.prop("selectedIndex",Q.prop("index"));S=Q;r(F,F.val())}F.parent().parent().toggle(!K);F.parent().parent().prev().toggle(!K);s.parent().parent().toggle(K);s.parent().parent().prev().toggle(K);I.prop("disabled",v);F.prop("disabled",v);P.prop("disabled",v||B!=="byMeasure");w.prop("disabled",B!=="byMeasure");q.prop("disabled",R||B!=="byMeasure");t.prop("disabled",R||B!=="byMeasure");s.children().prop("disabled",v);var J=Math.min(100,Math.max(0,G.val()));if(P[0]===p[0]){r(P,P.prop("checked")?1:0)}else{if(w[0]===p[0]){r(w,w.prop("checked")?1:0)}else{if(q[0]===p[0]){r(q.parent(),q.val())}else{if(t[0]===p[0]){r(t.parent(),t.val())}else{if(G[0]===p[0]){r(G.parent(),J)}else{if(N[0]===p[0]){r(N.parent(),N.val())}else{if(typeof p.prop("selectedIndex")!=="undefined"){r(p,p.val())}}}}}}}if(!v&&B==="primary"){var E=b.colors.primary[S.val()];C.empty().css({background:E,border:"1px solid gray"})}else{if(!v&&K){C.empty().css({background:"rgba(0,0,0,0)",border:"0"})}else{var A=F.val();var u={color:{auto:v,reverseScheme:P.prop("checked"),mode:v?"byMeasure":B,dimensionScheme:v?"12":A,measureScheme:v?"sg":A,alpha:1}};var O=p.parents("[id^=SRVPROPS]");if(O.length===0){O=p.parents("[id^=DOCPROPS]")}var H=O[0].id.match(/\\[^\.]+/)[0].replace("\\",d);var D=h.layers[H].layout.qInfo.qType==="ideviochartlayer";var x=b.isSchemeGradient(u);var y=b.getColorScheme(u,true,D);a.createColorBar(y,D&&v?false:x,null,C)}}}};window.eventHandler=window.eventHandler||function(s,r){var t={change:true,click:true,error:true,load:true};if(s&&s.type&&!(s.type in t)&&!(s.type==="keyup"&&s.keyCode&&s.keyCode===13)){return}d="Server";var p=$(s.target).parents("[id^=SRVPROPS]");if(p.length===0){p=$(s.target).parents("[id^=DOCPROPS]");d="Document"}var u=p[0].id.match(/\\[^\.]+/)[0].replace("\\",d);try{if(m[r]){if(/load/i.test(s.type)&&(!h.layers[u]&&!h.mapsToInitiate[u])){l.deferredLoadEvents[u]=l.deferredLoadEvents[u]||[];l.deferredLoadEvents[u].push(m[r].bind(m,s,u))}else{m[r](s,u)}}else{console.log("Unknown event:",r)}}catch(q){if(q.stack){console.error(q.stack)}else{console.error(q)}}}});