define(["./Utils"],function(h){var f=0;var d=1;var e=2;var g=3;var a=4;var c={0:"debug",1:"info",2:"warning",3:"error"};function b(k,i,j){this.map=k;this.layers={};this.mapProperties=j;this.entries={0:0,1:0,2:0,3:0};this.$element=i}b.prototype.clear=function(){this.layers={};this._clearEntries();var i=$(this.map.map.getDiv());i.find(".errorList").hide();this.updateList(i,this.mapProperties.logLevel)};b.prototype._clearEntries=function(){this.entries={0:0,1:0,2:0,3:0}};b.prototype.clearErrorsForLayer=function(i){for(var j in this.layers[i]){if(!this.layers[i].hasOwnProperty(j)){continue}this.entries[this.layers[i][j][0].logLevel]--}delete this.layers[i];var k=$(this.map.map.getDiv());this.updateList(k,this.mapProperties.logLevel)};b.prototype.clearErrorTypes=function(j,l){for(var k=0;k<l.length;k++){if(this.layers&&this.layers[j]&&this.layers[j][l[k]]){this.entries[this.layers[j][l[k]][0].logLevel]--;delete this.layers[j][l[k]]}}var m=$(this.map.map.getDiv());this.updateList(m,this.mapProperties.logLevel)};b.prototype.clearErrortypeForLayer=function(i,j){delete this.layers[i][j]};b.prototype._log=function(j,k,l,m,o,n){if(j<this.mapProperties.logLevel){return}if(!this.layers[k]){this.layers[k]={}}if(!this.layers[k][l]){this.layers[k][l]=[];this.entries[j]++}var i={message:m,dimension:o,value:n,logLevel:j};this.layers[k][l].push(i)};b.prototype.addError=function(i,j,k,m,l){this._log(g,i,j,k,m,l)};b.prototype.addWarning=function(i,j,k,m,l){this._log(e,i,j,k,m,l)};b.prototype.addInfo=function(i,j,k,m,l){this._log(d,i,j,k,m,l)};b.prototype.addDebug=function(i,j,k,m,l){this._log(f,i,j,k,m,l)};b.prototype.showErrors=function(){this.updateList(this.$element,this.mapProperties.logLevel)};b.prototype._copyToClipboard=function(j){var k=document.createElement("textarea");k.value=j;document.body.appendChild(k);k.select();try{document.execCommand("copy")}catch(i){window.prompt("Copy to clipboard: Ctrl+C, Enter",j)}document.body.removeChild(k)};b.prototype.updateList=function(o,m){var u=this;function w(i){var B=$(i.target).next().text();if(document.queryCommandSupported("copy")){u._copyToClipboard(B)}else{window.prompt("Copy to clipboard: Ctrl+C, Enter",B)}}var y=o.find("a.errorButton");var x=o.find(".errorList > ul");x.empty();x.css("max-height","calc("+o.height()+"px - 1.2em - 22px)");var l=0;if(this.entries[g]>0&&m!==a){l+=this.entries[g]}l+=this.entries[e];if(l>0){if(this.entries[g]){y.removeClass("warning");y.addClass("error")}else{if(this.entries[e]){y.removeClass("error");y.addClass("warning")}}y.html(l).attr("title","Show error messages").show();if(o.find("div.errorList").is(":visible")){y.attr("title","Hide error messages");for(var z in this.layers){if(!this.layers.hasOwnProperty(z)){continue}var A=h.layers[z].layerTitle;var t=this.layers[z];var j=0;var s=$("<div>").addClass("errordiv").append($("<b>").text(A+":"));for(var n in t){if(!t.hasOwnProperty(n)){continue}j=Math.max(t[n][0].logLevel,j);s.append($("<div>").addClass("copy-button"));var r=t[n][0].message+((t[n].length>1)?" ("+t[n].length+")":"");var p=$("<div>").addClass("error-message").append($("<p>").addClass("error-header").html(r));if(this.mapProperties.logLevel===f){for(var v=0;v<t[n].length;v++){var q=t[n][v].value;if(q===undefined||q.length===0){continue}p.append($("<p>").addClass("debug-message").text(q))}}s.append(p.append("<br>"))}var k=$("<li>").append(s.addClass(c[j]+" idevio-icon-before"));x.append(k)}$(".copy-button").click(w)}}else{y.hide();y.removeClass("error");y.addClass("warning")}};b.prototype.toggleList=function(l){var o=$(this.map.map.getDiv());var p=this;if(l.showErrorList&&(this.mapProperties.logLevel!==a)){var k=$("<div>").addClass("errorList");var m=$("<div>").addClass("menu");var n=$("<a>").addClass("idevio-icon-before").attr("title","Clear errors").click(function(){this.clear()}.bind(this));var j=$("<ul>");m.append(n);k.append(m);k.append(j);k.appendTo(o);k.hide();var i=$("<a>").addClass("errorButton idevio-icon-before warning").attr("title","Show error messages").hide().click(function(){k.toggle();p.updateList(o,p.mapProperties.logLevel)});i.appendTo(o)}else{o.find("a.errorButton").remove();o.find("div.errorList").remove()}};return b});