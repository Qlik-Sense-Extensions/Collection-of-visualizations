define(["./Utils"],function(i){var j=/,(?!\s*[\d\.])/;var l={};var f=null;var n=null;var h=7;var k={primary:["#b0afae","#7b7a78","#545352","#4477aa","#7db8da","#b6d7ea","#46c646","#f93f17","#ffcf02","#276e27","#ffffff","#000000"],12:["#332288","#6699cc","#88ccee","#44aa99","#117733","#999933","#ddcc77","#661100","#cc6677","#aa4466","#882255","#aa4499"],100:["#99c867","#e43cd0","#e2402a","#66a8db","#3f1a20","#e5aa87","#3c6b59","#aa2a6b","#e9b02e","#7864dd","#65e93c","#5ce4ba","#d0e0da","#d796dd","#64487b","#e4e72b","#6f7330","#932834","#ae6c7d","#986717","#e3cb70","#408c1d","#dd325f","#533d1c","#2a3c54","#db7127","#72e3e2","#e2c1da","#d47555","#7d7f81","#54ae9b","#e9daa6","#3a8855","#5be66e","#ab39a4","#a6e332","#6c469d","#e39e51","#4f1c42","#273c1c","#aa972e","#8bb32a","#bdeca5","#63ec9b","#9c3519","#aaa484","#72256d","#4d749f","#9884df","#e590b8","#44b62b","#ad5792","#c65dea","#e670ca","#e38783","#29312d","#6a2c1e","#d7b1aa","#b1e7c3","#cdc134","#9ee764","#56b8ce","#2c6323","#65464a","#b1cfea","#3c7481","#3a4e96","#6493e1","#db5656","#747259","#bbabe4","#e33f92","#d0607d","#759f79","#9d6b5e","#8574ae","#7e304c","#ad8fac","#4b77de","#647e17","#b9c379","#8da8b0","#b972d9","#786279","#7ec07d","#916436","#2d274f","#dce680","#759748","#dae65a","#459c49","#b7934a","#51c671","#9ead3f","#969a5c","#b9976a","#46531a","#c0f084","#76c146","#bad0ad"],sg:["#fff7bc","#fee391","#fec44f","#fb9a29","#ec7014","#cc4c02","#993404","#662506"],sc:["#fee391","#fec44f","#fb9a29","#ec7014","#cc4c02","#993404","#662506"],dg:["#3d52a1","#3a89c9","#77b7e5","#b4ddf7","#e6f5fe","#f9bd7e","#ed875e","#d24d3e","#ae1c3e"],dc:["#3d52a1","#3a89c9","#77b7e5","#b4ddf7","#e6f5fe","#ffe3aa","#f9bd7e","#ed875e","#d24d3e","#ae1c3e"]};function g(p){return p.split("").reduce(function o(r,q){r=((r<<5)-r)+q.charCodeAt(0);return r&r},0)}function b(o){return o.split(/(..)/).filter(String).map(function p(q){return parseInt(q,16)})}function e(o){if(!n){var p=document.createElement("canvas");p.width=p.height=1;n=p.getContext("2d")}try{n.createLinearGradient(0,0,1,1).addColorStop(0,o);return true}catch(q){return false}}function d(p){var q=$("<div style='color:#28e32a'>");var o="rgb(40, 227, 42)";q.css("color",p);if(q.css("color")===o&&p!==":#28e32a"&&p.replace(/ /g,"")!==o.replace(/ /g,"")){return false}else{return true}}function a(r){if(arguments.length===4){this.r=arguments[0];this.g=arguments[1];this.b=arguments[2];this.a=arguments[3];return}this.a=1;this.r=255;this.g=20;this.b=147;if(typeof r==="undefined"){return}if(isNaN(r)&&!d(r)){return}try{var w;if(typeof r==="number"){var o=r.toString(16);while(o.length<8){o="0"+o}w=b(o);this.a=w.shift()/255}else{if(/^#/.test(r)){w=b(r.replace("#",""))}else{if(/^rgba?/i.test(r)){w=r.replace(/rgba?\(|\)/gi,"").split(",").map(Number);if(/^rgba/i.test(r)){this.a=w.pop()}}else{if(/transparent/i.test(r)){this.a=this.r=this.g=this.b=0;return}else{if(/^hsla/i.test(r)){var s=/,\s*([\d\.]+)\s*\)$/;this.a=Number(r.match(s)[1]);r=r.replace(/^hsla/i,"hsl").replace(s,")")}}if(!f){var p=document.createElement("canvas");p.width=p.height=1;f=p.getContext("2d")}f.fillStyle=r||"red";f.beginPath();f.rect(0,0,1,1);f.fill();w=Array.prototype.slice.call(f.getImageData(0,0,1,1).data,0)}}}var v=w.shift();var q=w.shift();var t=w.shift();if(!((v===null)||(q===null)||(t===null))){this.r=v;this.g=q;this.b=t}else{this.a=1}}catch(u){throw ("Error converting color '"+r+"': "+u.message)}}a.prototype.applyAlpha=function(o){this.a*=Math.min(Math.max(isNaN(o)?1:o,0),1);return this};a.prototype.toRgba=function(){return"rgba("+this.r+","+this.g+","+this.b+","+this.a+")"};a.createInterpolated=function(t,q,u){var s=t.r+(q.r-t.r)*u;var p=t.g+(q.g-t.g)*u;var o=t.b+(q.b-t.b)*u;var r=t.a+(q.a-t.a)*u;return new a(s|0,p|0,o|0,r)};function c(q){if(q.color.auto){return k.primary[h]}var t=q.color.singleColor;var s=q.color.paletteColor;var r=typeof s==="undefined";var o=r||typeof s.color==="undefined";if(r||o){var p=0;if(!isNaN(s)&&s>=0){p=s}else{p=t}return k.primary[p]}else{return s.color.replace(/^none$/i,"transparent")}}return{DEFAULT_PRIMARY_COLOR:h,colors:k,Color:a,hash:g,isValidColor:e,isSchemeSingleColor:function(o){return i.getValue(o,"color.mode")==="primary"},isSchemeGradient:function(o){return i.getValue(o,"color.mode")==="byMeasure"&&/g$/.test(i.getValue(o,"color.measureScheme"))},isByDimension:function(o){return i.getValue(o,"color.mode")==="byDimension"},isByMeasure:function(o){return i.getValue(o,"color.mode")==="byMeasure"},isByExpression:function(o){return i.getValue(o,"color.mode")==="byExpression"},getPrimaryColor:function(o){return new a(c(o)).applyAlpha(o.color.alpha).toRgba()},splitStringIntoColors:function(o){return(o||"").split(j).map(function(p){return p.trim()})},getColorScheme:function m(s,r,u){var q=s.color;var o="primary";if(i.qlikview){if(((s&&s.qInfo&&s.qInfo.qType==="ideviochartlayer")||u)&&q.auto){o="12"}else{if(this.isSchemeSingleColor(s)){o="primary"}else{if(q.mode==="byDimension"){o=q.dimensionScheme}else{if(q.mode==="byMeasure"){o=q.measureScheme}}}}}else{if(s.visualization==="ideviochartlayer"&&q.auto){o="12"}else{if(this.isSchemeSingleColor(s)){o="primary"}else{if(q.mode==="byDimension"){o=q.dimensionScheme}else{if(q.mode==="byMeasure"){o=q.measureScheme}}}}}var p=k[o];if(!r&&q.alpha<1){o+=String(q.alpha);if(l[o]){p=l[o]}else{p=p.map(function t(v){return new a(v).applyAlpha(q.alpha).toRgba()});l[o]=p}}if(q.mode==="byMeasure"&&q.reverseScheme){p=p.slice().reverse()}return p},getColorAndIndex:function(u,A,B,C,E,p){p=p||1;var o=u.color;if(!i.getValue(o,"autoMinMax",true)){C=o.measureMin||C;E=o.measureMax||E}var D=new a().toRgba();var s=-1;var w;var y;var F;var z=i.qlikview?u.qInfo.qType==="ideviochartlayer":u.visualization==="ideviochartlayer";var q=z&&o.mode==="primary"&&!o.auto;var r=z&&(o.mode==="byDimension"||o.auto);var t=!z&&(o.auto||o.mode==="primary");var v=!z&&o.mode==="byDimension";if((i.qlikview&&o.mode==="primary")||((q||t)&&!i.qlikview)){s=o.auto?h:o.singleColor;D=c(u)}else{if((i.qlikview&&o.mode==="byDimension")||(i.qlikview&&r)||((r||v))){w=k["12"];if(!o.auto){w=k[o.dimensionScheme||"12"]}y=(g(B.toString())&16777215)%w.length;D=w[y];s=y}else{if(o.mode==="byMeasure"){w=k[o.auto?"sg":o.measureScheme];if(o.reverseScheme){w=w.slice().reverse()}y=0;var x=E-C;var G=0;if(C!==E){if(B<=C){G=0}else{if(B>=E){G=1}else{G=(x<=0)?0.5:(B-C)/x}}G=G*(w.length);y=Math.floor(G)>=w.length?w.length-1:Math.floor(G);if(this.isSchemeGradient(u)&&y<w.length-1){D=a.createInterpolated(new a(w[y]),new a(w[y+1]),G-y).toRgba();s=g(D)}else{D=w[y];s=y}}else{if(C===E){D=w[Math.floor(w.length/2)];s=Math.floor(w.length/2)}}}else{if(!i.qlikview&&u.color.mode==="byExpression"&&A[p]&&A[p].qAttrExps&&A[p].qAttrExps.qValues.length>0){F=A[p].qAttrExps.qValues[0];s=isNaN(F.qNum)?(F.qText?F.qText:"expression"):F.qNum;return{index:s,color:new a(s).applyAlpha(u.color.alpha).toRgba()}}else{if(i.qlikview&&u.color.mode==="byExpression"){F=A[i.layers[u.qInfo.qId].colorExpressionSource_];if(F){s=isNaN(F.qNum)?F.qText:F.qNum;return{index:s,color:new a(s).applyAlpha(u.color.alpha).toRgba()}}}}}}}if(o.alpha<1){D=new a(D).applyAlpha(o.alpha).toRgba()}return{color:D,index:s}},getColor:function(q,s,r,p,o){return this.getColorAndIndex(q,s,r||"",p,o).color},setupColorScheme:function(o){var p=false;if(!o.color||!o.color.mode){p=true;o.color={autoColor:true,mode:"byDimension",singleColor:h,measureScheme:"sg",dimensionScheme:"12",alpha:1,expressionIsColor:true}}}}});