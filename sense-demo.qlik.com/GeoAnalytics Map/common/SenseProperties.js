define(["./Utils","./ColorManager","./LocationManager","qlik"],function(i,c,l,m){var j={color:0,label:1,infoBubble:2,symbolUrl:3,symbolScale:4,symbolRotation:5};function g(q,o){var r=q.qHyperCubeDef.qMeasures;if(!r.length){return}r[0].qAttributeExpressions=r[0].qAttributeExpressions||[];for(var p=0;p<o;p++){r[0].qAttributeExpressions[p]=r[0].qAttributeExpressions[p]||{}}}function n(s,B,v){g(s,B.expressionIndex+1);var r;var A;var u;var t=null;var o=i.getValue(s,"qHyperCubeDef.qMeasures",[]);var z=i.getValue(s,"qHyperCubeDef.qLayoutExclude.qHyperCubeDef.qMeasures",[]);var y=function(D,C){if(D.type===B.expressionType){A=C}};if(o.length+z.length>1){for(r=z.length-1;r>=0;--r){u=z[r].qAttributeExpressions||[];A=-1;u.every(y);if(A>=0){t=u[A]}}for(r=o.length-1;r>=0;--r){u=o[r].qAttributeExpressions||[];A=-1;u.every(y);if(A>=0){t=u[A]}}if(!o[0].qAttributeExpressions&&t){o[0].qAttributeExpressions=[]}if(t){o[0].qAttributeExpressions[B.expressionIndex]=t}}var w=o.length!==0;var q=w&&o[0].qAttributeExpressions&&o[0].qAttributeExpressions.length>=B.expressionIndex+1;var x=i.getValue(s,B.backupExpression);if(q&&x){var p={type:B.expressionType};if(!v){p.qExpression=x}o[0].qAttributeExpressions[B.expressionIndex]=p}}function h(o){var q=o.location.suffix||"";var r=q.match(/^,([a-z]+)/i);var p=q.match(/:(.+)$/i);o.location.country=(r)?r[1].toUpperCase():"";o.location.type=(p)?p[1].toUpperCase():""}function b(o){var p="";if(o.location.country){p+=","+o.location.country}if(o.location.type){p+=":"+o.location.type}o.location.suffix=p}function e(o){var p=i.layers[o.qInfo.qId];if(p){p.clearLayer(true);p.cachedDatasets={}}}function k(o){if(o<20){return o}else{if(o<40){return 20+(o-20)*2}else{if(o<60){return 60+(o-40)*4}else{return 140+(o-60)*8}}}}function f(o){if(o<20){return o}else{if(o<60){return 20+(o-20)/2}else{if(o<140){return 40+(o-60)/4}else{return 60+(o-140)/8}}}}function d(o,v,q,r,t){var w=Math.log(r);var s=Math.log(t);var p=(s-w)/(q-v);var u=Number(Math.exp(w+p*(o-v)));return Math.round(u*100)/100}function a(o,v,q,r,t){var w=Math.log(r);var s=Math.log(t);var p=(s-w)/(q-v);var u=Number((Math.log(o)-w)/p+v);return Math.round(u)}return{getColorProperties:function(p){var o={uses:"colorsAndLegend",translation:"Colors",items:{colors:{items:{paletteColor:{defaultValue:c.DEFAULT_PRIMARY_COLOR},colorMode:{options:function(t){var s={value:"primary",translation:"properties.colorMode.primary"};var r={value:"byDimension",translation:"properties.colorMode.byDimension"};var v={value:"byMeasure",translation:"properties.colorMode.byMeasure"};var u={value:"byExpression",translation:"properties.colorMode.byExpression"};var q=[s,r,v];if(i.getValue(t,"qHyperCubeDef.qMeasures.length",0)>0){q.push(u)}return q}},persistentColors:{show:false},expressionIsColor:{defaultValue:true,show:false},colorTransparencySlider:{ref:"color.alpha",label:"Transparency",type:"number",defaultValue:1,min:0,max:1,step:0.05,component:"slider",resolveFunctions:{get:function(r,q){return 1-r(q.type)},set:function(s,q,r){q(r.type,1-s)}}},outlineColor:{ref:"color.outline",type:"string",label:"Outline Color (Only valid CSS colors)",defaultValue:"#aaaaaa",show:false}}},legend:{show:false}}};if(p&&p.outlineColor){o.items.colors.items.outlineColor={ref:"color.outline",type:"string",label:"Outline Color (Only valid CSS colors)",defaultValue:"#aaaaaa",invalid:function(q){if(!q.color.outline||q.color.outline.length===0){return false}if(c.isValidColor(q.color.outline)){return false}return true}}}return o},getInfoBubbleProperties:function(){return{type:"items",label:"Info Bubble",items:{showInfoBubble:{ref:"infoBubble.visible",label:"Show Info Bubble",type:"boolean",defaultValue:true,show:true},formatCustomInfoBubble:{ref:"infoBubble.formatCustom",label:"Info Bubble",component:"switch",type:"boolean",defaultValue:true,options:[{value:false,label:"Custom"},{value:true,label:"Auto"}],show:function(o){return o.infoBubble&&o.infoBubble.visible}},formatInfoBubbleHelp:{label:"Add measure to use expression.",component:"text",defaultValue:"Add measure to use expression.",show:function(o,p){return o.infoBubble&&o.infoBubble.visible&&o.infoBubble.formatCustom===false&&p.getMeasures().length<1}},attributeExpression:{type:"string",component:"expression",expressionType:"measure",schemaIgnore:true,ref:"qHyperCubeDef.qMeasures.0.qAttributeExpressions."+j.infoBubble+".qExpression",change:function(o){g(o,j.infoBubble+1);var q=i.getValue(o,"qHyperCubeDef.qMeasures.0.qAttributeExpressions."+j.infoBubble);var p=i.getValue(o,"infoBubble");if(q){q.type="infoBubbleExpression"}if(p){p.expression=q.qExpression}},globalChange:function(q){var p={expressionIndex:j.infoBubble,expressionType:"infoBubbleExpression",backupExpression:"infoBubble.expression"};var o=q.infoBubble.formatCustom||!q.infoBubble.visible;n(q,p,o)},show:function(o,p){return o.infoBubble&&o.infoBubble.visible&&o.infoBubble.formatCustom===false&&p.getMeasures().length>=1}},formatNumbers:{ref:"infoBubble.formatNumbers",label:"Format Numbers",type:"boolean",defaultValue:true,show:function(o){return o.infoBubble&&o.infoBubble.visible}},formatNumbersAuto:{ref:"infoBubble.formatNumbersAuto",label:"Format",component:"switch",type:"boolean",defaultValue:true,options:[{value:false,label:"Custom"},{value:true,label:"Auto"}],show:function(o){return o.infoBubble&&o.infoBubble.visible&&o.infoBubble.formatNumbers}},formatNumberList:{ref:"infoBubble.formatNumberList",label:"Values to format, in the order they are added (eg: 1,3,4).",type:"string",defaultValue:"",show:function(o){return o.infoBubble&&o.infoBubble.visible&&o.infoBubble.formatNumbers&&!o.infoBubble.formatNumbersAuto},invalid:function(o){var p=o.infoBubble.formatNumberList;if(!p||p.length===0){return false}return !/^\d+(,\d+)*$/.test(p)}}}}},getLabelProperties:function(p){var o={type:"items",label:"Label",items:{showLabel:{ref:"label.visible",label:"Show Label",type:"boolean",defaultValue:false,show:true},labelHelp:{label:"Add measure to use expression.",component:"text",defaultValue:"Add measure to use expression.",show:function(q,r){return q.label&&q.label.visible&&r.getMeasures().length<1}},attributeExpression:{type:"string",component:"expression",expressionType:"measure",schemaIgnore:true,ref:"qHyperCubeDef.qMeasures.0.qAttributeExpressions."+j.label+".qExpression",change:function(r){g(r,j.label+1);var s=i.getValue(r,"qHyperCubeDef.qMeasures.0.qAttributeExpressions."+j.label);var q=i.getValue(r,"label");if(s){s.type="labelExpression"}if(q){q.expression=s.qExpression}},globalChange:function(s){var r={expressionIndex:j.label,expressionType:"labelExpression",backupExpression:"label.expression"};var q=(s&&s.label&&s.label.visible)?!s.label.visible:true;n(s,r,q)},show:function(q,r){return q.label&&q.label.visible&&r.getMeasures().length>=1}},sizeSlider:{type:"number",component:"slider",ref:"label.slider",min:0,max:10000,step:1,defaultValue:10000,show:function(q,r){return q.label&&q.label.visible&&r.getMeasures().length>=1},label:function(q){return"Outer resolution limit: "+q.label.outres},change:function(q){var s=q.label.slider;var r=i.getValueFromLogScale(s,0,10000,0.1,160000);q.label.outres=r}},setOuterResolution:{label:"Set to Current Resolution",component:"button",show:function(q,r){return q.label&&q.label.visible&&r.getMeasures().length>=1},action:function(t){var s=Math.round(i.maps[t.mapid].map.getResolution()*10)/10;var r=i.getValueFromLogScaleRevert(s,0,10000,0.1,160000);var q=i.layers[t.qInfo.qId];q.extension.backendApi.getProperties().then(function(u){u.label.slider=r;u.label.outres=s;q.extension.backendApi.setProperties(u)})}},outResLimit:{ref:"label.outres",label:"Out Resolution Limit",type:"number",defaultValue:160000,show:function(){return false}}}};if(p){o.items.position={type:"items",label:"Position",items:{posSwitch:{ref:"label.position",label:"Position",component:"dropdown",type:"string",defaultValue:"TOP",show:function(q,r){return q.label&&q.label.visible&&r.getMeasures().length>=1},options:[{value:"TOP",label:"Below"},{value:"BOTTOM",label:"Above"},{value:"MIDDLE",label:"Centered"}]}}}}return o},getLayerProperties:function(p,s){var w={type:"items",label:"Layer Options",items:{id:{ref:"mapid",label:"Map ID",type:"string",component:"dropdown",options:function o(){return Object.keys(i.maps).reduce(function(B,C){var D=i.maps[C];B.push({value:C,label:(D?D.properties.title+" ":"")+"("+C+")"});return B},[])},invalid:function z(B){return i.isValidMapId(B.mapid)},change:function q(B){var C=i.layers[B.qInfo.qId];C.layout=B;C.setMap(i.maps[B.mapid]);m.resize()}},maxObjects:{ref:"dummyMaxObjects",type:"integer",show:false},calcCond:{ref:"qHyperCubeDef.qCalcCond",label:"Calculation Condition",type:"string",component:"expression",expressionType:"ValueExpr"},customErrorMessage:{ref:"qHyperCubeDef.customErrorMessage.calcCond",label:"Calculation Condition Message",component:"textarea",defaultValue:"",type:"string",placeholderTranslation:"Object.ErrorMessage.CalculationCondition",show:function(C){var B=i.getValue(C,"qHyperCubeDef.qCalcCond");return B.qv&&B.qv!==""}},visible:{ref:"visible",type:"boolean",defaultValue:true,show:false,options:[{value:false,label:"Hidden"},{value:true,label:"Visible"}]},selectable:{ref:"selectable",type:"boolean",defaultValue:true,show:false,options:[{value:false,label:"Hidden"},{value:true,label:"Visible"}]},resolutionSlider:{type:"array",component:"slider",ref:"resolutionLimit.range",min:0,max:10000,step:1,defaultValue:[0,10000],label:function(B){var D=B.inResolutionLimit.value;var C=B.outResolutionLimit.value;return"Zoom Limits In "+D+" | Out "+C},change:function(F){var C=F.resolutionLimit.range;var E=Math.round(i.maps[F.mapid].map.getResolution()*10)/10;var D=i.getValueFromLogScaleRevert(E,0,10000,0.1,160000);if(C[0]>=D){var G=D-(1+Math.random()*0.00001);C[0]=G;F.inResolutionLimit.value=i.getValueFromLogScale(G,0,10000,0.1,160000)}else{F.inResolutionLimit.value=i.getValueFromLogScale(C[0],0,10000,0.1,160000)}if(C[1]<=D){var B=D+(1+Math.random()*0.00001);C[1]=B;F.outResolutionLimit.value=i.getValueFromLogScale(B,0,10000,0.1,160000)}else{F.outResolutionLimit.value=i.getValueFromLogScale(C[1],0,10000,0.1,160000)}}},inResolutionLimit:{ref:"inResolutionLimit.value",label:"In Resolution Limit",type:"number",defaultValue:0,min:0,max:160000,show:false,change:function r(C){var B=i.layers[C.qInfo.qId];if(B&&B.layer){B.layer.setMinRes(C.inResolutionLimit.value)}},invalid:function v(B){return B.inResolutionLimit.value>=B.outResolutionLimit.value}},outResolutionLimit:{ref:"outResolutionLimit.value",label:"Out Resolution Limit",type:"number",defaultValue:160000,min:1,max:160000,show:false,change:function t(C){var B=i.layers[C.qInfo.qId];if(B&&B.layer){B.layer.setMaxRes(C.outResolutionLimit.value)}},invalid:function y(B){return B.outResolutionLimit.value<=B.inResolutionLimit.value}},restrictDrillDownLevel:{ref:"restrictDrillDownLevel",label:"Restrict Drill Down",type:"string",defaultValue:"0-16",show:false},restrictDrillDownLevelSlider:{ref:"restrictDrillDownLevelSlider",type:"array",component:"slider",min:0,max:16,step:1,defaultValue:[0,16],show:p!=="ideviogeodatalayer",label:function(B){return"Restric Drill Down "+B.restrictDrillDownLevel},change:function(B){var C=B.restrictDrillDownLevelSlider;if(C[0]===C[1]){B.restrictDrillDownLevel=""+C[0]}else{B.restrictDrillDownLevel=""+C[0]+"-"+C[1]}}},includeInAutoZoom:{ref:"includeInAutoZoom",label:"Include in Auto Zoom",type:"boolean",defaultValue:true,show:function(B){return B.visualization!=="ideviogeodatalayer"}},useSoftPatch:{ref:"usingSoftPatch",label:"Disable when Inactive",type:"boolean",defaultValue:false,show:false,change:function(B){if(B.usingSoftPatch){alert('Note! In "Disable when Inactive" mode, if you want to edit the layer properties, only do so when the layer is active!')}}},drawOrderToggle:{ref:"draworder.auto",label:"Draw Order",type:"boolean",component:"switch",defaultValue:true,change:i.setDrawOrder,options:[{value:false,label:"Custom"},{value:true,label:"Auto"}]},drawOrderSettings:{type:"items",show:function x(B){return B.draworder&&!B.draworder.auto},items:{drawOrderCategory:{ref:"draworder.category",label:"Draw Order Category",component:"dropdown",options:[{value:"ideviochartlayer",label:"Chart Layer"},{value:"ideviobubblelayer",label:"Bubble Layer"},{value:"ideviolinelayer",label:"Line Layer"},{value:"idevioheatmaplayer",label:"Heatmap Layer"},{value:"idevioarealayer",label:"Area Layer"},{value:"ideviogeodatalayer",label:"Geodata Layer"},{value:"bglabels",label:"Base Map Labels"}],defaultValue:p,change:i.setDrawOrder},drawOrderAdjustment:{ref:"draworder.adjustment",label:"Draw Order Adjustment",type:"integer",defaultValue:0,min:-10,max:+10,change:i.setDrawOrder}}}}};if(!s){w.items.maxObjects={ref:"maxObjects",label:"Maximum Number of Objects",type:"integer",defaultValue:i.MAX_OBJECTS,invalid:function u(B){return B.maxObjects<1},change:function A(B){var D=B.qInfo.qId;var C=i.maps[i.layers[D].mapid];if(C){C.logger.clearErrorsForLayer(D,"requestTooMuchData")}}}}return w},getLegendProperties:function(o){o=o||{};return{translation:"Legend",items:{sizeLegend:{type:"items",show:!!o.hasSizes,items:{showCategorySizes:{ref:"legend.sizes.auto",label:"Size Legend",type:"boolean",component:"switch",defaultValue:true,options:[{value:false,label:"Custom"},{value:true,label:"Auto"}]},sizeLegendSettings:{type:"items",show:function(p){return !i.getValue(p,"legend.sizes.auto",true)},items:{colorDisplay:{type:"boolean",ref:"legend.sizes.showSizes",label:"Show Sizes",defaultValue:true},minMax:{type:"boolean",ref:"legend.sizes.showMinMax",defaultValue:true,label:"Show Size Min/Max Values"},title:{type:"boolean",ref:"legend.sizes.showTitle",defaultValue:true,label:"Show Size Title"}}}}},colorLegend:{type:"items",show:!!o.hasColors,items:{showCategoryColors:{ref:"legend.colors.auto",label:"Color Legend",type:"boolean",component:"switch",defaultValue:true,options:[{value:false,label:"Custom"},{value:true,label:"Auto"}]},colorLegendSettings:{type:"items",show:function(p){return !i.getValue(p,"legend.colors.auto",true)},items:{colorDisplay:{type:"boolean",ref:"legend.colors.showColors",label:"Show Colors",defaultValue:true},minMax:{type:"boolean",ref:"legend.colors.showMinMax",defaultValue:true,label:"Show Color Min/Max Values"},title:{type:"boolean",ref:"legend.colors.showTitle",defaultValue:true,label:"Show Color Title"}}}}},miscLegend:{type:"items",items:{showTitle:{ref:"legend.showIconTitle",label:"Show Icon Title",type:"boolean",defaultValue:true,show:!!o.hasIconTitle},showLegendIcon:{ref:"legend.showIcon",label:"Show Icon",type:"boolean",defaultValue:true,show:!!o.hasIcon},showUrlLabel:{ref:"legend.showUrl",label:"Show URL/Title",type:"boolean",defaultValue:true,show:!!o.hasUrl},showCustomTitle:{ref:"legend.customTitle",label:"Custom Title (empty for default)",type:"string",defaultValue:"",show:!!o.hasCustomTitle}}}}}},getLocationProperties:function(t,p){return{type:"items",label:"Location Options",items:{locationSource:{ref:"location.source",label:"Location Source",component:"dropdown",options:p,defaultValue:"auto"},service:{ref:"location.service",label:"Location Service URL",type:"string",expression:"optional",defaultValue:t?"i:///pointgeom/default":"i:///areageom/default"},viaServer:{ref:"location.viaServer",label:"Load via Server",type:"boolean",defaultValue:false},servicetype:{ref:"location.serviceType",label:"Location Service Type",component:"dropdown",options:[{value:"FILE_GEOJSON",label:"GeoJSON File"},{value:"FILE_GML",label:"GML / WFS File"},{value:"SERVICE",label:"Geometry Service"}],defaultValue:"SERVICE"},key:{ref:"location.keyAttribute",label:"Source Key Attribute",type:"string",defaultValue:"",show:function(u){return/^file/i.test(i.getValue(u,"location.serviceType"))}},forceFileReload:{type:"boolean",ref:"location.forceFileReload",label:"Force File Reload",defaultValue:false,show:function s(u){return i.getValue(u,"location.serviceType","").indexOf("FILE_")===0}},advancedLocation:{ref:"location.advancedLocation",label:"Advanced Location",type:"boolean",component:"switch",defaultValue:false,options:[{value:false,label:"Off"},{value:true,label:"On"}],show:function q(u){return i.getValue(u,"location.serviceType")==="SERVICE"}},country:{ref:"location.country",label:"Country",type:"string",component:"dropdown",defaultValue:"",options:l.countryCodes,change:b,show:function o(u){return !i.getValue(u,"location.advancedLocation",false)&&i.getValue(u,"location.serviceType")==="SERVICE"}},type:{ref:"location.type",label:"Type",type:"string",component:"dropdown",defaultValue:"",options:l.locationTypes,change:b,show:function r(u){return !i.getValue(u,"location.advancedLocation",false)&&i.getValue(u,"location.serviceType")==="SERVICE"}},suffix:{ref:"location.suffix",label:"Location ID Suffix",type:"string",defaultValue:"",change:h,show:function q(u){if(u.location.advancedLocation===undefined){h(u)}return i.getValue(u,"location.advancedLocation",false)&&i.getValue(u,"location.serviceType")==="SERVICE"}},remap:{ref:"location.remap",label:"Manual Remap",type:"string",defaultValue:""},gmlsettings:{type:"items",items:{geoName:{type:"string",label:"Geometry Attribute",ref:"location.gml.geoName",defaultValue:"the_geom",change:e},reverseCoordinates:{type:"boolean",label:"Reverse Coordinates",defaultValue:false,ref:"location.gml.reverse",change:e}},show:function(u){return/gml$/i.test(i.getValue(u,"location.serviceType"))}}}}},getSizeProperties:function(q,s,p,o){var r={type:"items",label:"Shape and Size",items:{shape:{ref:"dummyShape",type:"integer",show:false},symbolUrl:{ref:"dummyUrl",type:"integer",show:false},symbolUrlHelper:{ref:"dummyUrlHelper",type:"integer",show:false},symbolScale:{ref:"dummyScale",type:"integer",show:false},symbolRotation:{ref:"dummyRotation",type:"integer",show:false},width:{label:"Width",ref:"barwidth",type:"integer",defaultValue:10,show:function(t){return t&&t.geometry&&t.geometry.shape&&t.geometry.shape==="bars"},invalid:function(t){return t.barwidth<0}},minHeight:{label:"",ref:"bars.minHeightDummy",type:"integer",defaultValue:0,show:false},maxHeight:{label:"",ref:"bars.maxHeightDummy",type:"integer",defaultValue:0,show:false},sizeSlider:{type:"array",component:"slider",ref:"size.range",min:0,max:80,step:1,defaultValue:[s,p],show:function(t){if(!o){return true}else{return t&&t.geometry&&t.geometry.shape&&t.geometry.shape!=="symbols"}},label:function(t){if(o&&t.geometry&&t.geometry.shape==="bars"){return"Height Min "+t.bars.minHeight+"  -  Max "+t.bars.maxHeight}else{return q+" Min "+t[q].min.value+"  -  Max "+t[q].max.value}},change:function(v){var u=i.getSizeFromSliderValue(v.size.range[0]);var t=i.getSizeFromSliderValue(v.size.range[1]);if(o&&v.geometry&&v.geometry.shape==="bars"){v.bars.minHeight=u;v.bars.maxHeight=t}else{v[q].min.value=u;v[q].max.value=t}}},minSize:{ref:q+".min.value",type:"integer",defaultValue:s,label:function(t){if(o&&t.geometry&&t.geometry.shape==="bars"){return"Min Height"}else{return"Min "+q}},change:function(u){var t=u.size.range;t[0]=i.getSliderValueFromSize(u[q].min.value)},show:function(){return false},invalid:function(t){return t[q].min.value<0||t[q].min.value>300}},maxSize:{ref:q+".max.value",type:"integer",defaultValue:p,change:function(u){var t=u.size.range;t[1]=f(u[q].max.value)},label:function(t){if(o&&t.geometry&&t.geometry.shape==="bars"){return"Max Height"}else{return"Max "+q}},show:function(){return false},invalid:function(t){return t[q].max.value<0||t[q].max.value>300}},minSizeValueSwitch:{ref:q+".minValue.manual",label:function(u){var t=q;if(u&&u.geometry&&u.geometry.shape&&u.geometry.shape==="bars"){t="Height"}return"Min "+t+" Value"},component:"switch",type:"boolean",defaultValue:true,options:[{value:false,label:"Specify"},{value:true,label:"Auto"}],show:function(t){if(o&&t&&t.geometry){return t.geometry.shape!=="symbols"}return true}},minSizeValue:{ref:q+".minValue.value",type:"number",defaultValue:0,show:function(t){return t[q]&&t[q].minValue&&!t[q].minValue.manual}},maxSizeValueSwitch:{ref:q+".maxValue.manual",label:function(u){var t=q;if(u&&u.geometry&&u.geometry.shape&&u.geometry.shape==="bars"){t="Height"}return"Max "+t+" Value"},component:"switch",type:"boolean",defaultValue:true,options:[{value:false,label:"Specify"},{value:true,label:"Auto"}],show:function(t){if(o&&t&&t.geometry){return t.geometry.shape!=="symbols"}return true}},maxSizeValue:{ref:q+".maxValue.value",type:"number",defaultValue:0,show:function(t){return t[q]&&t[q].maxValue&&!t[q].maxValue.manual}}}};if(o){r.items.shape={label:"Shape",ref:"geometry.shape",component:"dropdown",options:[{value:"bubbles",label:"Bubbles"},{value:"triangles",label:"Triangles"},{value:"squares",label:"Squares"},{value:"pentagons",label:"Pentagons"},{value:"hexagons",label:"Hexagons"},{value:"bars",label:"Bars"},{value:"symbols",label:"Symbols"}],defaultValue:"bubbles",change:function(v){if(v.geometry&&v.geometry.shape==="symbols"){v.color.mode="primary"}var u;var t;if(v.geometry&&v.geometry.shape==="bars"){u=v.bars.minHeight;t=v.bars.maxHeight}else{u=v[q].min.value;t=v[q].max.value}v.size={range:[i.getSliderValueFromSize(u),i.getSliderValueFromSize(t)]}}};r.items.symbolUrl={label:"Image URL",type:"string",component:"expression",expressionType:"measure",schemaIgnore:true,ref:"qHyperCubeDef.qMeasures.0.qAttributeExpressions."+j.symbolUrl+".qExpression",change:function(t){g(t,j.symbolUrl+1);var v=i.getValue(t,"qHyperCubeDef.qMeasures.0.qAttributeExpressions."+j.symbolUrl);var u=i.getValue(t,"geometry");if(v){v.type="symbolExpression"}if(u){u.expression=v.qExpression}},globalChange:function(v){var u={expressionIndex:j.symbolUrl,expressionType:"symbolExpression",backupExpression:"geometry.expression"};var t=v&&v.geometry&&v.geometry.shape&&v.geometry.shape!=="symbols";n(v,u,t)},show:function(t,u){return t&&t.geometry&&t.geometry.shape==="symbols"&&u.getMeasures().length>0}};r.items.symbolUrlHelper={label:"Please add at least one measure in order to use symbols.",component:"text",show:function(t,u){return t&&t.geometry&&t.geometry.shape==="symbols"&&u.getMeasures().length===0}};r.items.symbolScale={label:"Scale",type:"string",component:"expression",expressionType:"measure",schemaIgnore:true,ref:"qHyperCubeDef.qMeasures.0.qAttributeExpressions."+j.symbolScale+".qExpression",change:function(t){g(t,j.symbolScale+1);var v=i.getValue(t,"qHyperCubeDef.qMeasures.0.qAttributeExpressions."+j.symbolScale);var u=i.getValue(t,"geometry");if(v){v.type="symbolScaleExpression"}if(u){u.scaleexpression=v.qExpression}},globalChange:function(v){var u={expressionIndex:j.symbolScale,expressionType:"symbolScaleExpression",backupExpression:"geometry.scaleexpression"};var t=v&&v.geometry&&v.geometry.shape&&v.geometry.shape!=="symbols";n(v,u,t)},show:function(t,u){return t&&t.geometry&&t.geometry.shape==="symbols"&&u.getMeasures().length>0}};r.items.symbolRotation={label:"Rotation (Degrees)",type:"string",component:"expression",expressionType:"measure",schemaIgnore:true,ref:"qHyperCubeDef.qMeasures.0.qAttributeExpressions."+j.symbolRotation+".qExpression",change:function(t){g(t,j.symbolRotation+1);var v=i.getValue(t,"qHyperCubeDef.qMeasures.0.qAttributeExpressions."+j.symbolRotation);var u=i.getValue(t,"geometry");if(v){v.type="symbolRotationExpression"}if(u){u.rotationexpression=v.qExpression}},globalChange:function(v){var u={expressionIndex:j.symbolRotation,expressionType:"symbolRotationExpression",backupExpression:"geometry.rotationexpression"};var t=v&&v.geometry&&v.geometry.shape&&v.geometry.shape!=="symbols";n(v,u,t)},show:function(t,u){return t&&t.geometry&&t.geometry.shape==="symbols"&&u.getMeasures().length>0}};r.items.minHeight={label:"Min Height",ref:"bars.minHeight",type:"integer",defaultValue:0,change:function(t){if(t.bars&&(!t.bars.maxHeight)){t.bars.maxHeight=20}},show:function(t){return false&&t&&t.geometry&&t.geometry.shape==="bars"},invalid:function(t){return t.bars&&t.bars.minHeight<0}};r.items.maxHeight={label:"Max Height",ref:"bars.maxHeight",type:"integer",defaultValue:20,change:function(t){if(t.bars&&(!t.bars.minHeight)){t.bars.minHeight=0}},show:function(t){return false&&t&&t.geometry&&t.geometry.shape==="bars"},invalid:function(t){return t.bars&&t.bars.maxHeight<0}}}return r}}});