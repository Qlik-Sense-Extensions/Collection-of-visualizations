define(["angular","qvangular","../config/config","../modules/utils/wiUtils"],function(a,b){"use strict";b.service("wiLocalRepositoryService",["$q","$http",function(b,c){var d,e,f=function(){var a=this,c=b.defer();return a.snippetsInitialized?(a.snippetsInitialized=!0,c.resolve(!0)):this.getSnippets().then(function(b){a.snippets=b,a.snippetsInitialized=!0,c.resolve(!0)}).catch(function(b){a.snippets=null,c.reject(b)}),c.promise},g=function(){var a=b.defer(),d="/extensions/qwidget/snippets/_snippets.json";return c.get(d).success(function(b){a.resolve(b.snippets)}).error(function(b,c){a.reject({error:b,errorStatus:c})}),a.promise},h=function(c){var d=this,e=b.defer();return!this.widgetsInitialized||c?this.getWidgets().then(function(a){d.widgets=a,d.widgetsInitialized=!0,e.resolve(!0)}).catch(function(a,b){e.reject({error:a,errorStatus:b})}).finally(function(){a.noop()}):e.resolve(!0),e.promise},i=function(){var a=b.defer(),d="/extensions/qwidget/rep/widgets.json";return c.get(d).then(function(b){a.resolve(b.data)}).catch(function(b,c){a.reject({errorDesc:"Cannot get widgets from repository",error:b,errorStatus:c})}),a.promise},j=function(a){var d=b.defer(),e="/extensions/qwidget/rep/"+a._id+"/",f=e+"html.html",g=e+"css.txt",h=e+"data.json",i=[c.get(f,{cache:!1}),c.get(g,{cache:!1}),c.get(h,{cache:!1})];return b.all(i).then(function(a){d.resolve(a)}).catch(function(a){d.reject(a)}),d.promise};return{initSnippets:f,getSnippets:g,snippets:d,initWidgets:h,getWidgets:i,widgets:e,getWidgetDetails:j}}])});