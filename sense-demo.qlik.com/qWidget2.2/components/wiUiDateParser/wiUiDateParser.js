define(["angular","qvangular"],function(a,b){"use strict";b.service("wiUiDateParser",["$locale","orderByFilter","$compile",function(b,c){function d(a,b,c){return 1===b&&c>28?29===c&&(a%4===0&&a%100!==0||a%400===0):3===b||5===b||8===b||10===b?31>c:!0}this.parsers={};var e={yyyy:{regex:"\\d{4}",apply:function(a){this.year=+a}},yy:{regex:"\\d{2}",apply:function(a){this.year=+a+2e3}},y:{regex:"\\d{1,4}",apply:function(a){this.year=+a}},MMMM:{regex:b.DATETIME_FORMATS.MONTH.join("|"),apply:function(a){this.month=b.DATETIME_FORMATS.MONTH.indexOf(a)}},MMM:{regex:b.DATETIME_FORMATS.SHORTMONTH.join("|"),apply:function(a){this.month=b.DATETIME_FORMATS.SHORTMONTH.indexOf(a)}},MM:{regex:"0[1-9]|1[0-2]",apply:function(a){this.month=a-1}},M:{regex:"[1-9]|1[0-2]",apply:function(a){this.month=a-1}},dd:{regex:"[0-2][0-9]{1}|3[0-1]{1}",apply:function(a){this.date=+a}},d:{regex:"[1-2]?[0-9]{1}|3[0-1]{1}",apply:function(a){this.date=+a}},EEEE:{regex:b.DATETIME_FORMATS.DAY.join("|")},EEE:{regex:b.DATETIME_FORMATS.SHORTDAY.join("|")}};this.createParser=function(b){var d=[],f=b.split("");return a.forEach(e,function(a,c){var e=b.indexOf(c);if(e>-1){b=b.split(""),f[e]="("+a.regex+")",b[e]="$";for(var g=e+1,h=e+c.length;h>g;g++)f[g]="",b[g]="$";b=b.join(""),d.push({index:e,apply:a.apply})}}),{regex:new RegExp("^"+f.join("")+"$"),map:c(d,"index")}},this.parse=function(c,e){if(!a.isString(c))return c;e=b.DATETIME_FORMATS[e]||e,this.parsers[e]||(this.parsers[e]=this.createParser(e));var f=this.parsers[e],g=f.regex,h=f.map,i=c.match(g);if(i&&i.length){for(var j,k={year:1900,month:0,date:1,hours:0},l=1,m=i.length;m>l;l++){var n=h[l-1];n.apply&&n.apply.call(k,i[l])}return d(k.year,k.month,k.date)&&(j=new Date(k.year,k.month,k.date,k.hours)),j}}}])});