define(["jquery","underscore","qvangular","./../../modules/utils/wiUtils","../../services/wiService"],function(a,b,c,d){"use strict";c.directive("wiView",["$compile","wiService",function(c,e){var f=function(f,g,h){var i;f.$watch(function(){return{wiViewHtml:f.$eval(h.wiViewHtml),wiViewLess:f.$eval(h.wiViewLess)}},function(j){function k(b,c){var d=a(document.createElement("style"));d.attr("type","text/css"),d.html(c),b.append(d)}"true"===f.Main.IsDebug,void 0!==i&&i.$destroy(),i=f.$new();var l=j.wiViewHtml,m=j.wiViewLess;m=d.noScript(m),l=d.noScript(l);var n=f.$eval(h.wiViewUnescape);n&&(m=d.decodeFromEngine(m),l=d.decodeFromEngine(l));var o=a(document.createElement("div"));o.addClass("wiView_container"),o.css("position","relative"),b.isEmpty(m)||(m=m.replace(/"/g,"'")),e.compileString(f,m).then(function(a){var b=e.createScopedCss(g.attr("id"),a);k(o,b)}).catch(function(a){angular.noop()}).finally(function(){g.empty();var b=a(document.createElement("div"));b.addClass("wiView_htmlContainer"),b.html(l),o.append(b),g.html(o.prop("outerHTML")),c(g.contents())(i),"true"===f.Main.IsDebug&&angular.noop()}),f.$on("$destroy",function(){g.remove()})},!0)};return{restrict:"AE",priority:0,require:["^qvObject"],replace:!0,link:f}}])});