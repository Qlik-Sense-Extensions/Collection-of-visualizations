define(["../IdevioMap/common/SenseProperties","../IdevioMap/common/Utils"],function(c,e){var b={FILE_GEOJSON:"GeoJSON File",FILE_GML:"GML / WFS File",TILES_WMS:"WMS",TILES_TMS:"TMS",TILES_IDEVIO:"GeoAnalytics GetMap"};function a(f){return f.geodata&&/^TILES/.test(f.geodata.sourceformat)}function d(f){var h=e.layers[f.qInfo.qId];if(h.layer){var g=h.layer.getDataset();if(!a(f)&&g instanceof idevio.map.MemoryDataset){h.layer.getDataset().removeAll()}h.layer.remove();delete h.layer}}return{SOURCEFORMATS:b,isTiles:a,type:"items",component:"accordion",items:{geodatasettings:{type:"items",translation:"Geodata Options",items:{sourceurl:{ref:"geodata.sourceurl",label:"Source URL",expression:"optional",type:"string",change:d,defaultValue:"",show:function(f){return !a(f)}},tileurl:{ref:"geodata.tileurl",expression:"optional",type:"string",change:d,defaultValue:"",show:function(f){return a(f)},label:function(g){var f=g.geodata.sourceformat==="TILES_WMS";return f?"WMS Service URL":"Tile Service URL"}},sourceformat:{ref:"geodata.sourceformat",label:"Source Format",component:"dropdown",options:(function(){return Object.keys(b).map(function(f){return{value:f,label:b[f]}})})(),change:function(f){d(f)},defaultValue:"FILE_GEOJSON"},styles:{ref:"geodata.styles",label:"Styles",type:"string",show:function(f){return !a(f)},change:function(f){var g=e.layers[f.qInfo.qId];if(!g||!g.layer){return}if(f.geodata.styles!==""){g.layer.setStyles(e.parseStyles(f.geodata.styles))}else{g.layer.setStyles([])}},invalid:function(f){return e.parseStyles(f.geodata.styles)===null},defaultValue:'{"type":"polygon", "color":"white", "outline":"blue"},{"type":"line", "color":"green", "width":"1"},{"type":"symbol", "icon":{ "url" : "i://osm/images/dropgreen.png"}}',basicStyle:'{"type":"polygon", "color":"white", "outline":"gray"}'},loadviaserver:{ref:"geodata.loadviaserver",label:"Load via Server",type:"boolean",defaultValue:false,change:d,show:function(f){return !a(f)||/WMS$/i.test(e.getValue(f,"geodata.sourceformat"))}},gmlsettings:{type:"items",items:{geoName:{type:"string",label:"Geometry Attribute",ref:"geodata.gml.geoName",change:d},reverseCoordinates:{type:"boolean",label:"Reverse Coordinates",defaultValue:false,ref:"geodata.gml.reverse",change:d}},show:function(f){return/gml$/i.test(e.getValue(f,"geodata.sourceformat"))}},tilesizePixels:{ref:"geodata.tilesize",label:"Tile Size (pixels)",type:"integer",defaultValue:256,change:d,show:function(f){return a(f)&&f.geodata.sourceformat!=="TILES_WMS"}},wmsVersion:{ref:"geodata.wms.version",label:"WMS Version",type:"string",component:"dropdown",options:[{value:"1.1.0",label:"1.1.0"},{value:"1.1.1",label:"1.1.1"},{value:"1.3.0",label:"1.3.0"}],defaultValue:"1.3.0",change:d,show:function(f){return f.geodata.sourceformat==="TILES_WMS"}},wmsBuffer:{ref:"geodata.wms.buffer",label:"Buffer",type:"number",defaultValue:100,change:d,show:function(f){return f.geodata.sourceformat==="TILES_WMS"}},crs:{ref:"geodata.wms.crs",label:"CRS",type:"string",defaultValue:"EPSG:4326",change:d,show:function(f){return f.geodata.sourceformat==="TILES_WMS"}},showAdvanced:{ref:"geodata.auto",label:"Advanced Settings",type:"boolean",component:"switch",defaultValue:true,show:function(f){return/TMS$/i.test(e.getValue(f,"geodata.sourceformat"))},change:d,options:[{value:false,label:"Custom"},{value:true,label:"Auto"}]},advanced:{type:"items",show:function(f){return f.geodata.auto===false&&/TMS$/i.test(e.getValue(f,"geodata.sourceformat"))},items:{tileWidth:{ref:"geodata.tileWidth",label:"Tile Width",type:"number",defaultValue:40075016,change:d},tileHeight:{ref:"geodata.tileHeight",label:"Tile Height",type:"number",defaultValue:40075016,change:d},originX:{ref:"geodata.originX",label:"Origin Left",type:"number",defaultValue:-20037508,change:d},originY:{ref:"geodata.originY",label:"Origin Top",type:"number",defaultValue:20037508,change:d}}}}},layersettings:c.getLayerProperties("ideviogeodatalayer",true),settings:{uses:"settings",items:{general:c.getLegendProperties({hasIcon:true,hasUrl:true,hasCustomTitle:true})}}}}});