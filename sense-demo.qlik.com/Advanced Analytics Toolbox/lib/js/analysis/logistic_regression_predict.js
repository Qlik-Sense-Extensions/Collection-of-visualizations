"use strict";define(["../util/utils","ng!$q"],function(t,e){return{createCube:function(e,a){var r=a.layout,s=t.validateDimension(r.props.dimensions[0]),n=[{qNullSuppression:!0,qDef:{qFieldDefs:[s]}}],l=r.props.measures.length;a.rowsLabel=["(Intercept)",""!=r.props.measures[1].label?r.props.measures[1].label:t.validateMeasure(r.props.measures[0])];for(var d=t.validateMeasure(r.props.measures[0])+" as mea0, "+t.validateMeasure(r.props.measures[1])+" as mea1",o="mea0 ~ mea1",i="NN",p=2;p<l;p++){var u=t.validateMeasure(r.props.measures[p]);if(u.length>0){var h=","+u+" as mea"+p;d+=h,o+=" + mea"+p,i+="N",a.rowsLabel.push(t.validateMeasure(r.props.measures[p]))}}var c=t.splitData(!0,r.props.splitPercentage,l);t.displayDebugModeMessage(r.props.debugMode);var f=t.getDebugSaveDatasetScript(r.props.debugMode,"debug_logistic_regression_predict.rda"),m="R.ScriptEvalExStr('"+i+"','"+f+" library(jsonlite); "+c+" lm_result <- glm("+o+', data=training_data, family=binomial(link="logit"));lm_summary <- summary(lm_result);\n      pred <- predict(lm_result, test_data, type="response"); pred_result <- ifelse(pred > 0.5,1,0); act_result <- ifelse(test_data$mea0 > 0.5,1,0); conf.mat<-table(pred_result, act_result);\n      json<-toJSON(list(list(attributes(conf.mat)$dimnames[[1]], attributes(conf.mat)$dimnames[[2]]), unname(split(conf.mat, seq(nrow(conf.mat)))), c(length(training_data$mea0), length(test_data$mea0))));json;\','+d+")";t.displayRScriptsToConsole(r.props.debugMode,[m]);var b=[{qDef:{qDef:m}},{qDef:{qLabel:"-",qDef:""}},{qDef:{qLabel:"-",qDef:""}},{qDef:{qLabel:"-",qDef:""}},{qDef:{qLabel:"-",qDef:""}}];return a.backendApi.applyPatches([{qPath:"/qHyperCubeDef/qDimensions",qOp:"replace",qValue:JSON.stringify(n)},{qPath:"/qHyperCubeDef/qMeasures",qOp:"replace",qValue:JSON.stringify(b)}],!1),a.patchApplied=!0,null},drawChart:function(a){var r=e.defer(),s=a.layout,n=(t.validateDimension(s.props.dimensions[0]),[{qTop:0,qLeft:0,qWidth:2,qHeight:1}]);return a.backendApi.getData(n).then(function(e){if(0===e[0].qMatrix[0][1].qText.length||"-"==e[0].qMatrix[0][1].qText)t.displayConnectionError(a.extId);else{t.displayReturnedDatasetToConsole(s.props.debugMode,e[0]);for(var n=JSON.parse(e[0].qMatrix[0][1].qText),l=n[0][0],d=n[0][1],o=n[1],i=n[2],p=function(t,e){return Math.round(t*Math.pow(10,e))/Math.pow(10,e)},u='\n            <h2>Confusion matrix:</h2>\n            <table class="simple" >\n              <thead>\n                <tr>\n                  <th rowspan="2" style="border-right:none;"></th><th rowspan="2"></th><th colspan="'+(d.length+1)+'" style="text-align:center">Actual class</th>\n                </tr>\n                <tr>\n                  ',h=0;h<d.length;h++)u+="<th>"+d[h]+"</th>";u+="<th>Precision</th></tr>\n            </thead>\n            <tbody>";for(var c=0,f=0,m=[],b=[],g=[],q=[],y=0;y<d.length;y++)b[y]=0,g[y]=0;for(var v=0;v<l.length;v++){u+=0===v?'<tr><td rowspan="'+(l.length+1)+'" style="font-weight:bold; white-space:nowrap; width:20px">Predicted class</td><td style="font-weight:bold">'+l[v]+"</td>":'<tr><td style="font-weight:bold">'+l[v]+"</td>";for(var D=0,M=0,w=0;w<d.length;w++)f+=o[v][w],M+=o[v][w],g[w]+=o[v][w],l[v]===d[w]&&(c+=o[v][w],D+=o[v][w],b[w]+=o[v][w]),u+="<td>"+o[v][w]+"</td>";m.push(D/M),u+="class"===s.props.rpartMethod?"<td>"+p(D/M*100,3)+"%</td></tr>":"<td>-</td></tr>"}u+='<tr><td style="font-weight:bold;">Recall</td>';for(var _=0;_<b.length;_++)u+="class"===s.props.rpartMethod?"<td>"+p(b[_]/g[_]*100,3)+"%</td>":"<td>-</td>",q.push(b[_]/g[_]);u+="<td></td></tr>",u+="</tbody>\n                  </table>";var x=function(t){return t.reduce(function(t,e,a,r){return t+e})},N=function(t,e){return x(t,e)/t.length};u+='<h2>Performance measures:</h2>\n                  <table class="simple" style="table-layout:fixed;">\n                    <thead>\n                      <tr>\n                        <th>Measures</th><th>Results</th>\n                      </tr>\n                    </thead>\n                    <tbody>\n                      <tr><td>Accuracy</td><td>'+("class"===s.props.rpartMethod?p(c/f*100,3)+"%":"-")+"</td></tr>\n                      <tr><td>Average precision</td><td>"+("class"===s.props.rpartMethod?p(100*N(m),3)+"%":"-")+"</td></tr>\n                      <tr><td>Average recall</td><td>"+("class"===s.props.rpartMethod?p(100*N(q),3)+"%":"-")+"</td></tr>\n                    </tbody>\n                  </table>\n                ",u+='<h2>Number of rows:</h2>\n                  <table class="simple" style="table-layout:fixed;">\n                    <thead>\n                      <tr>\n                        <th>Datasets</th><th>Number of rows</th>\n                      </tr>\n                    </thead>\n                    <tbody>\n                      <tr><td>Training data</td><td>'+i[0]+"</td></tr>\n                      <tr><td>Test data</td><td>"+i[1]+"</td></tr>\n                      <tr><td>Total</td><td>"+(i[0]+i[1])+"</td></tr>\n                    </tbody>\n                  </table>\n                ",$(".advanced-analytics-toolsets-"+a.extId).html(u)}return r.resolve()}),r.promise}}});
//# sourceMappingURL=../../maps/analysis/logistic_regression_predict.js.map
