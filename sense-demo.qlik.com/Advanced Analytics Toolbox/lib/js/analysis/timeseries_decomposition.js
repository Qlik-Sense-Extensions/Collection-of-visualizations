"use strict";define(["../chart/line_chart","../util/utils","ng!$q"],function(e,a,r){return{createCube:function(e,r){var o=r.layout,t=a.validateDimension(o.props.dimensions[0]),i=[{qNullSuppression:!0,qDef:{qFieldDefs:[t]}}],s=a.validateMeasure(o.props.measures[0]);a.displayDebugModeMessage(o.props.debugMode);var p=a.getDebugSaveDatasetScript(o.props.debugMode,"debug_timeseries_decomposition.rda"),n="R.ScriptEval('"+p+" library(dplyr);data<-ts(q$Measure,frequency="+o.props.frequency+');(decompose(data, type="'+o.props.seasonal+"\")$trend);', "+s+" as Measure)",l="R.ScriptEval('library(dplyr);data<-ts(q$Measure,frequency="+o.props.frequency+');(decompose(data, type="'+o.props.seasonal+"\")$seasonal);', "+s+" as Measure)",u="R.ScriptEval('library(dplyr);data<-ts(q$Measure,frequency="+o.props.frequency+');(decompose(data, type="'+o.props.seasonal+"\")$random);', "+s+" as Measure)";a.displayRScriptsToConsole(o.props.debugMode,[n,l,u]);var d=[{qDef:{qDef:s}},{qDef:{qDef:n}},{qDef:{qDef:l}},{qDef:{qDef:u}},{qDef:{qLabel:"-",qDef:""}}];return r.backendApi.applyPatches([{qPath:"/qHyperCubeDef/qDimensions",qOp:"replace",qValue:JSON.stringify(i)},{qPath:"/qHyperCubeDef/qMeasures",qOp:"replace",qValue:JSON.stringify(d)}],!1),r.patchApplied=!0,null},drawChart:function(o,t){var i=r.defer(),s=o.layout,p=[{qTop:0,qLeft:0,qWidth:6,qHeight:1500}];return o.backendApi.getData(p).then(function(r){var p=o.layout.qHyperCube.qMeasureInfo;return isNaN(p[1].qMin)&&isNaN(p[1].qMax)&&isNaN(p[2].qMin)&&isNaN(p[2].qMax)&&isNaN(p[3].qMin)&&isNaN(p[3].qMax)?a.displayConnectionError(o.extId):!function(){a.displayReturnedDatasetToConsole(s.props.debugMode,r[0]);for(var i=void 0,p=void 0,n=void 0,l=a.getDefaultPaletteColor(),u=[],d=function(e){i=[],p=[],n=[],$.each(r[0].qMatrix,function(a,r){i.push(r[0].qElemNumber),p.push(r[0].qText),n.push(r[e].qNum)});var a={x:p,y:n,elemNum:i,name:1===e?"Observed":2===e?"Trend":3===e?"Seasonal":4===e?"Random":"",mode:"lines+markers",fill:s.props.line,fillcolor:s.props.colors?"rgba("+l[3]+",0.3)":"rgba("+l[s.props.colorForMain]+",0.3)",marker:{color:s.props.colors?"rgba("+l[3]+",1)":"rgba("+l[s.props.colorForMain]+",1)",size:s.props.datapoints?s.props.pointRadius:1},line:{width:s.props.borderWidth}};s.props.decomposeInFourCharts&&4!=e&&(a.xaxis="x",a.yaxis="y"+(5-e)),u.push(a)},c=1;c<5;c++)d(c);$(".advanced-analytics-toolsets-"+o.extId).html('<div id="aat-chart-'+o.extId+'" style="width:100%;height:100%;"></div>');var f="";if(s.props.decomposeInFourCharts){var y={showlegend:o.layout.props.showLegend,xaxis:{showgrid:o.layout.props.xScale},yaxis:{title:"Random",domain:[0,.24],showgrid:o.layout.props.yScale,tickformat:a.getTickFormat(o,0),tickprefix:a.getPrefix(o,0),ticksuffix:a.getSuffix(o,0)},yaxis2:{title:"Seasonal",domain:[.25,.49],anchor:"x2",showgrid:o.layout.props.yScale,tickformat:a.getTickFormat(o,0),tickprefix:a.getPrefix(o,0),ticksuffix:a.getSuffix(o,0)},yaxis3:{title:"Trend",domain:[.5,.74],anchor:"x3",showgrid:o.layout.props.yScale,tickformat:a.getTickFormat(o,0),tickprefix:a.getPrefix(o,0),ticksuffix:a.getSuffix(o,0)},yaxis4:{title:"Observed",domain:[.74,1],anchor:"x4",showgrid:o.layout.props.yScale,tickformat:a.getTickFormat(o,0),tickprefix:a.getPrefix(o,0),ticksuffix:a.getSuffix(o,0)},dragmode:"select",margin:{r:"right"==o.layout.props.yAxisPosition?o.layout.props.marginRight+70:o.layout.props.marginRight,l:"left"==o.layout.props.yAxisPosition?o.layout.props.marginLeft+70:o.layout.props.marginLeft,t:"top"==o.layout.props.xAxisPosition?o.layout.props.marginTop+70:o.layout.props.marginTop,b:"bottom"==o.layout.props.xAxisPosition?o.layout.props.marginBottom+70:o.layout.props.marginBottom}};f=e.draw(o,u,"aat-chart-"+o.extId,y)}else f=e.draw(o,u,"aat-chart-"+o.extId,null);e.setEvents(f,o,t)}(),i.resolve()}),i.promise}}});
//# sourceMappingURL=../../maps/analysis/timeseries_decomposition.js.map
