"use strict";define(["../chart/line_chart","../util/utils","ng!$q"],function(e,a,r){return{createCube:function(e,r){for(var s=r.layout,t=(s.props.numberOfClusters,a.validateDimension(s.props.dimensions[0])),o=[{qNullSuppression:!0,qDef:{qFieldDefs:[t]}}],p=s.props.measures.length,i=a.validateMeasure(s.props.measures[0])+" as mea0",n="q$mea0",l="N",d=1;d<p;d++){var u=a.validateMeasure(s.props.measures[d]);if(u.length>0){var c=","+u+" as mea"+d;i+=c,n+=",q$mea"+d,l+="N"}}var q="cbind("+n+")";s.props.scaleData&&(q="scale(cbind("+n+"))"),a.displayDebugModeMessage(s.props.debugMode);var f=a.getDebugSaveDatasetScript(s.props.debugMode,"debug_kmeans_optimize.rda"),m="";"undefined"!=typeof s.props.optimizationMethod&&"gap"!=s.props.optimizationMethod||(m="R.ScriptEvalExStr('"+l+"','"+f+" library(cluster); library(jsonlite); set.seed(1); gap_kmeans<-clusGap("+q+", FUNcluster=kmeans, K.max="+s.props.clusterMax+", B="+s.props.bootstrap+"); json<-toJSON(gap_kmeans$Tab); json;', "+i+")"),a.displayRScriptsToConsole(s.props.debugMode,[m]);var b=[{qDef:{qDef:m}},{qDef:{qLabel:"-",qDef:""}},{qDef:{qLabel:"-",qDef:""}},{qDef:{qLabel:"-",qDef:""}},{qDef:{qLabel:"-",qDef:""}}];return r.backendApi.applyPatches([{qPath:"/qHyperCubeDef/qDimensions",qOp:"replace",qValue:JSON.stringify(o)},{qPath:"/qHyperCubeDef/qMeasures",qOp:"replace",qValue:JSON.stringify(b)}],!1),r.patchApplied=!0,null},drawChart:function(s,t){var o=r.defer(),p=s.layout,i=(a.validateDimension(p.props.dimensions[0]),[{qTop:0,qLeft:0,qWidth:6,qHeight:1}]);return s.backendApi.getData(i).then(function(r){s.layout.qHyperCube.qMeasureInfo;if(0===r[0].qMatrix[0][1].qText.length||"-"==r[0].qMatrix[0][1].qText)a.displayConnectionError(s.extId);else{a.displayReturnedDatasetToConsole(p.props.debugMode,r[0]);var t=JSON.parse(r[0].qMatrix[0][1].qText),i=a.getOneHundredColors(),n=[],l=[],d=[];$.each(t,function(e,a){n.push(e+1),l.push(a[2]),d.push(a[3])});var u=[{x:n,y:l,name:"Gap statistic",error_y:{type:"data",symmetric:!1,array:d,arrayminus:d,thickness:p.props.borderWidth,color:p.props.colors?"rgba("+i[3]+",1)":"rgba("+i[p.props.colorForMain]+",1)"},type:"scatter",mode:"markers+lines",marker:{color:p.props.colors?"rgba("+i[3]+",1)":"rgba("+i[p.props.colorForMain]+",1)",size:p.props.pointRadius}}];$(".advanced-analytics-toolsets-"+s.extId).html('<div id="aat-chart-'+s.extId+'" style="width:100%;height:100%;"></div>'),e.draw(s,u,"aat-chart-"+s.extId,null)}return o.resolve()}),o.promise}}});
//# sourceMappingURL=../../maps/analysis/kmeans_optimize.js.map
