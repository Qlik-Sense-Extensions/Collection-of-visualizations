"use strict";define(["../chart/bubble_chart","../util/utils","ng!$q"],function(e,a,s){return{createCube:function(e,s){for(var r=s.layout,t=r.props.numberOfClusters,u=a.validateDimension(r.props.dimensions[0]),n=[{qNullSuppression:!0,qDef:{qFieldDefs:[u]}}],l=r.props.measures.length,p=a.validateMeasure(r.props.measures[0])+" as mea0",o="q$mea0",i=1;i<l;i++){var d=a.validateMeasure(r.props.measures[i]);if(d.length>0){var c=","+d+" as mea"+i;p+=c,o+=",q$mea"+i}}var m="cbind("+o+")";r.props.scaleData&&(m="scale(cbind("+o+"))");var q=a.validateMeasure(r.props.measures[0]),f=a.validateMeasure(r.props.measures[1]);a.displayDebugModeMessage(r.props.debugMode);var b=a.getDebugSaveDatasetScript(r.props.debugMode,"debug_kmeans.rda"),v="R.ScriptEval('"+b+" set.seed(1);kmeans("+m+","+t+")$cluster', "+p+")";a.displayRScriptsToConsole(r.props.debugMode,[v]);var h=[{qDef:{qDef:q}},{qDef:{qDef:f}},{qDef:{qDef:v}},{qDef:{qLabel:"-",qDef:""}},{qDef:{qLabel:"-",qDef:""}}];return s.backendApi.applyPatches([{qPath:"/qHyperCubeDef/qDimensions",qOp:"replace",qValue:JSON.stringify(n)},{qPath:"/qHyperCubeDef/qMeasures",qOp:"replace",qValue:JSON.stringify(h)}],!1),s.patchApplied=!0,null},drawChart:function(r,t){var u=s.defer(),n=r.layout;return a.pageExtensionData(r,function(s){var l=r.layout.qHyperCube.qMeasureInfo;if(isNaN(l[2].qMin)&&isNaN(l[2].qMax))a.displayConnectionError(r.extId);else{a.displayReturnedDatasetToConsole(n.props.debugMode,s);for(var p=(a.getOneHundredColors(),[]),o=1;o<=n.props.numberOfClusters;o++)p[o]=[],p[o].elemNum=[],p[o].text=[],p[o].x=[],p[o].y=[];$.each(s,function(e,a){p[a[3].qNum].elemNum.push(a[0].qElemNumber),p[a[3].qNum].text.push(a[0].qText),p[a[3].qNum].x.push(a[1].qNum),p[a[3].qNum].y.push(a[2].qNum)});for(var i=[],d=1;d<=n.props.numberOfClusters;d++)i.push({x:p[d].x,y:p[d].y,elemNum:p[d].elemNum,text:p[d].text,name:"cluster "+d,mode:"markers",type:"scatter",marker:{size:n.props.bubbleSize}});$(".advanced-analytics-toolsets-"+r.extId).html('<div id="aat-chart-'+r.extId+'" style="width:100%;height:100%;"></div>');var c=e.draw(r,t,i,"aat-chart-"+r.extId,null);e.setEvents(c,r,t),$("#aat-chart-"+r.extId+" .legend .traces .legendtoggle").css("display","none"),$("#aat-chart-"+r.extId+" g.traces").on("click",function(e){var a=p[e.currentTarget.childNodes[1].textContent.replace("cluster ","")].text,s=a.map(function(e){return parseInt(e,10)});t.field(r.layout.props.dimensions[0].expression).selectValues(s,!0,!0)})}return u.resolve()}),u.promise}}});
//# sourceMappingURL=../../maps/analysis/kmeans.js.map
