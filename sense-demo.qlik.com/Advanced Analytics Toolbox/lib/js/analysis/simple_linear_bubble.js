"use strict";define(["../chart/bubble_chart","../util/utils","ng!$q"],function(e,a,r){return{createCube:function(e,r){var s=r.layout,t=a.validateDimension(s.props.dimensions[0]),l=[{qNullSuppression:!0,qDef:{qFieldDefs:[t]}}];a.displayDebugModeMessage(s.props.debugMode);var o=a.getDebugSaveDatasetScript(s.props.debugMode,"debug_simple_linear_bubble.rda"),i=a.validateMeasure(s.props.measures[0]),p=a.validateMeasure(s.props.measures[1]),u="R.ScriptEval('"+o+' lm_result <- lm(q$Measure2~q$Measure1);predict(lm_result, interval="'+s.props.interval+'", level='+s.props.confidenceLevel+")[,1]',"+i+" as Measure1, "+p+" as Measure2)",n="R.ScriptEval('lm_result <- lm(q$Measure2~q$Measure1);predict(lm_result, interval=\""+s.props.interval+'", level='+s.props.confidenceLevel+")[,2]',"+i+" as Measure1, "+p+" as Measure2)",m="R.ScriptEval('lm_result <- lm(q$Measure2~q$Measure1);predict(lm_result, interval=\""+s.props.interval+'", level='+s.props.confidenceLevel+")[,3]',"+i+" as Measure1, "+p+" as Measure2)";a.displayRScriptsToConsole(s.props.debugMode,[u,n,m]);var d=[{qDef:{qDef:i}},{qDef:{qDef:p}},{qDef:{qLabel:"Fit",qDef:u}},{qDef:{qLabel:"Lower",qDef:n}},{qDef:{qLabel:"Upper",qDef:m}}];return r.backendApi.applyPatches([{qPath:"/qHyperCubeDef/qDimensions",qOp:"replace",qValue:JSON.stringify(l)},{qPath:"/qHyperCubeDef/qMeasures",qOp:"replace",qValue:JSON.stringify(d)}],!1),r.patchApplied=!0,null},drawChart:function(s,t){var l=r.defer(),o=s.layout,i=a.validateDimension(o.props.dimensions[0]);return a.pageExtensionData(s,function(r){var p=s.layout.qHyperCube.qMeasureInfo;if(isNaN(p[2].qMin)&&isNaN(p[2].qMax)&&isNaN(p[3].qMin)&&isNaN(p[3].qMax)&&isNaN(p[4].qMin)&&isNaN(p[4].qMax))a.displayConnectionError(s.extId);else{a.displayReturnedDatasetToConsole(o.props.debugMode,r);var u=a.getDefaultPaletteColor(),n=[],m=[],d=[],c=[],q=[],f=[],b=[],v=r.map(function(e){return{elemNum:e[0].qElemNumber,dim1:e[0].qText,mea1:e[1].qNum,mea2:e[2].qNum,mea3:e[3].qNum,mea4:e[4].qNum,mea5:e[5].qNum}});v.sort(function(e,a){return parseFloat(e.mea1)-parseFloat(a.mea1)}),$.each(v,function(e,a){n.push(a.elemNum),m.push(a.dim1),d.push(a.mea1),c.push(a.mea2),q.push(a.mea3),f.push(a.mea4),b.push(a.mea5)});var M=[{x:d,y:c,elemNum:n,text:m,name:i,mode:"markers",type:"scatter",marker:{color:o.props.colors?"rgba("+u[3]+",0.8)":"rgba("+u[o.props.colorForMain]+",0.8)",size:o.props.bubbleSize}},{x:d,y:q,name:"Fit",line:{color:"rgba("+u[o.props.colorForSub]+",1)"}},{x:d,y:f,name:"Lower",fill:"tonexty",fillcolor:"rgba("+u[o.props.colorForSub]+",0.3)",type:"scatter",mode:"none"},{x:d,y:b,name:"Upper",fill:"tonexty",fillcolor:"rgba("+u[o.props.colorForSub]+",0.3)",type:"scatter",mode:"none"}];$(".advanced-analytics-toolsets-"+s.extId).html('<div id="aat-chart-'+s.extId+'" style="width:100%;height:100%;"></div>');var y=e.draw(s,t,M,"aat-chart-"+s.extId,null);e.setEvents(y,s,t)}return l.resolve()}),l.promise}}});
//# sourceMappingURL=../../maps/analysis/simple_linear_bubble.js.map
