"use strict";define(["../util/utils","ng!$q"],function(e,a){return{createCube:function(a,t){var r=t.layout,s=e.validateDimension(r.props.dimensions[0]),o=[{qNullSuppression:!0,qDef:{qFieldDefs:[s]}}],i=r.props.measures.length;t.rowsLabel=[e.validateMeasure(r.props.measures[0])];for(var n=e.validateMeasure(r.props.measures[0])+" as mea0",p="q$mea0",l="N",u=1;u<i;u++){var d=e.validateMeasure(r.props.measures[u]);if(d.length>0){var q=","+d+" as mea"+u;n+=q,p+=",q$mea"+u,l+="N",t.rowsLabel.push(e.validateMeasure(r.props.measures[u]))}}e.displayDebugModeMessage(r.props.debugMode);var c=e.getDebugSaveDatasetScript(r.props.debugMode,"debug_pca.rda"),f="R.ScriptEvalExStr('"+l+"','"+c+" library(jsonlite); pca_result<-prcomp(data.frame("+p+"), center = TRUE, scale = TRUE); json<-toJSON(list(summary(pca_result)$importance, summary(pca_result)$rotation)); json;',"+n+")";e.displayRScriptsToConsole(r.props.debugMode,[f]);var h=[{qDef:{qDef:f}},{qDef:{qLabel:"-",qDef:""}},{qDef:{qLabel:"-",qDef:""}},{qDef:{qLabel:"-",qDef:""}},{qDef:{qLabel:"-",qDef:""}}];return t.backendApi.applyPatches([{qPath:"/qHyperCubeDef/qDimensions",qOp:"replace",qValue:JSON.stringify(o)},{qPath:"/qHyperCubeDef/qMeasures",qOp:"replace",qValue:JSON.stringify(h)}],!1),t.patchApplied=!0,null},drawChart:function(t){var r=a.defer(),s=t.layout,o=(e.validateDimension(s.props.dimensions[0]),[{qTop:0,qLeft:0,qWidth:6,qHeight:1}]);return t.backendApi.getData(o).then(function(a){t.layout.qHyperCube.qMeasureInfo;if(0===a[0].qMatrix[0][1].qText.length||"-"==a[0].qMatrix[0][1].qText)e.displayConnectionError(t.extId);else{e.displayReturnedDatasetToConsole(s.props.debugMode,a[0]);for(var o=JSON.parse(a[0].qMatrix[0][1].qText),i=o[0],n=o[1],p='<table class="simple"><thead><tr><th></th>',l=0;l<i[0].length;l++)p+="<th>PC"+(l+1)+"</th>";p+="</tr></thead><tbody>";var u="";$.each(i,function(e,a){u+="<tr><td>",u+=0==e?"Standard deviation":1==e?"Proportion of Variance":2==e?"Cumulative Proportion":"",u+="</td>",$.each(a,function(e,a){u+="<td>"+a+"</td>"}),u+="</tr>"});var d="";$.each(n,function(e,a){d+="<tr><td>"+t.rowsLabel[e],$.each(a,function(e,a){d+="<td>"+a+"</td>"}),d+="</tr>"});var q="</tbody></table>",c="<h2>Importance of components:</h2>"+p+u+q,f="<h2>Rotation:</h2>"+p+d+q,h=c+f;$(".advanced-analytics-toolsets-"+t.extId).html(h)}return r.resolve()}),r.promise}}});
//# sourceMappingURL=../../maps/analysis/pca.js.map
