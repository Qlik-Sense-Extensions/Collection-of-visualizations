"use strict";define(["../chart/bubble_3d_chart","../util/utils","ng!$q"],function(e,a,s){return{createCube:function(e,s){for(var r=s.layout,t=r.props.numberOfClusters,u=a.validateDimension(r.props.dimensions[0]),p=[{qNullSuppression:!0,qDef:{qFieldDefs:[u]}}],i=r.props.measures.length,o=a.validateMeasure(r.props.measures[0])+" as mea0",n="q$mea0",l=1;l<i;l++){var d=a.validateMeasure(r.props.measures[l]);if(d.length>0){var q=","+d+" as mea"+l;o+=q,n+=",q$mea"+l}}var c="cbind("+n+")";r.props.scaleData&&(c="scale(cbind("+n+"))");var m=a.validateMeasure(r.props.measures[0]),f=a.validateMeasure(r.props.measures[1]),b=a.validateMeasure(r.props.measures[2]);a.displayDebugModeMessage(r.props.debugMode);var v=a.getDebugSaveDatasetScript(r.props.debugMode,"debug_kmeans_3d.rda"),D="R.ScriptEval('"+v+" set.seed(1);kmeans("+c+","+t+")$cluster', "+o+")";a.displayRScriptsToConsole(r.props.debugMode,[D]);var h=[{qDef:{qDef:m}},{qDef:{qDef:f}},{qDef:{qDef:b}},{qDef:{qDef:D}},{qDef:{qLabel:"-",qDef:""}}];return s.backendApi.applyPatches([{qPath:"/qHyperCubeDef/qDimensions",qOp:"replace",qValue:JSON.stringify(p)},{qPath:"/qHyperCubeDef/qMeasures",qOp:"replace",qValue:JSON.stringify(h)}],!1),s.patchApplied=!0,null},drawChart:function(r,t){var u=s.defer(),p=r.layout;a.validateDimension(p.props.dimensions[0]);return a.pageExtensionData(r,function(s){var i=r.layout.qHyperCube.qMeasureInfo;if(isNaN(i[3].qMin)&&isNaN(i[3].qMax))a.displayConnectionError(r.extId);else{a.displayReturnedDatasetToConsole(p.props.debugMode,s);for(var o=a.getOneHundredColors(),n=[],l=1;l<=p.props.numberOfClusters;l++)n[l]=[],n[l].text=[],n[l].x=[],n[l].y=[],n[l].z=[];$.each(s,function(e,a){n[a[4].qNum].text.push(a[0].qText),n[a[4].qNum].x.push(a[1].qNum),n[a[4].qNum].y.push(a[2].qNum),n[a[4].qNum].z.push(a[3].qNum)});for(var d=[],q=1;q<=p.props.numberOfClusters;q++)d.push({x:n[q].x,y:n[q].y,z:n[q].z,text:n[q].text,name:"cluster "+q,mode:"markers",type:"scatter3d",marker:{color:"rgba("+o[q-1]+",0.7)",size:p.props.bubbleSize,opacity:.8,line:{color:"rgba("+o[q-1]+", 1)",width:1}}});$(".advanced-analytics-toolsets-"+r.extId).html('<div id="aat-chart-'+r.extId+'" style="width:100%;height:100%;"></div>'),e.draw(r,t,d,"aat-chart-"+r.extId,null)}return u.resolve()}),u.promise}}});
//# sourceMappingURL=../../maps/analysis/kmeans_3d.js.map
