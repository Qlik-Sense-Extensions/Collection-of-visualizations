define([],function(){function a(){this.intervalId=null;this.dimensionsToAnimate=[];this.index=0;this.isPaused=true;this.isSlideEvent=false}a.prototype.reset=function(){clearInterval(this.intervalId);this.toSelect=[];this.dimensionsToAnimate=[];this.index=0;this.requestData()};a.prototype.init=function(b,d,c){this.$element=b;this.layout=d;this.backendApi=c;this.requestData(true);$("<img>").prop({id:"idevio-animator-trick-image-"+this.layout.qInfo.qId,src:"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"}).on("load",function(){$("#idevio-animator-trick-image-"+this.layout.qInfo.qId).remove();this.updateUI()}.bind(this)).hide().appendTo(this.$element)};a.prototype.createUI=function(){this.$element.css("overflow","hidden");var e=$("<div>").prop("id","idevio-animator-main-"+this.layout.qInfo.qId).appendTo(this.$element);var b=$("<div>").prop("id","idevio-animator-controls-"+this.layout.qInfo.qId).addClass("idevio-animator-controls").appendTo(e);$("<button>").prop("id","idevio-animator-start-button-"+this.layout.qInfo.qId).addClass("idevio-animator-button idevio-animator-start-button").click(this.start.bind(this)).appendTo(b);$("<button>").prop("id","idevio-animator-pause-button-"+this.layout.qInfo.qId).addClass("idevio-animator-button idevio-animator-pause-button").click(this.pause.bind(this)).hide().appendTo(b);$("<div>").prop("id","idevio-slider-"+this.layout.qInfo.qId).addClass("idevio-slider").appendTo(b);var c=$("<div>").addClass("idevio-animator-value").appendTo(e);$("<span>").prop("id","idevio-animator-value-"+this.layout.qInfo.qId).css({position:"absolute",top:"0"}).appendTo(c);var g=this;$("#idevio-slider-"+this.layout.qInfo.qId).slider({value:0,min:0,max:this.dimensionsToAnimate.length-1,step:1,slide:function(i,j){var k=g.layout.qHyperCube.qDimensionInfo[0].qFallbackTitle;var h=g.dimensionsToAnimate[j.value].qText||g.dimensionsToAnimate[j.value].qNum;g.setLabelAndText(k,h)},change:function(h,i){if(g.isPaused&&h.originalEvent){g.isSlideEvent=true;g.index=i.value;g.backendApi.selectValues(0,[g.dimensionsToAnimate[i.value].qElemNumber],false)}}});if(this.dimensionsToAnimate.length>0){var f=this.layout.qHyperCube.qDimensionInfo[0].qFallbackTitle;var d=this.dimensionsToAnimate[$("#idevio-slider-"+this.layout.qInfo.qId).slider("value")].qText||this.dimensionsToAnimate[$("#idevio-slider-"+this.layout.qInfo.qId).slider("value")].qNum;this.setLabelAndText(f,d)}};a.prototype.setLabelAndText=function(c,b){var d="";if(this.layout.animator.showLabel){d+="<b>"+c+"</b> "}if(this.layout.animator.showDimValue){d+=b}$("#idevio-animator-value-"+this.layout.qInfo.qId).html(d)};a.prototype.resetSlider=function(){$("#idevio-slider-"+this.layout.qInfo.qId).slider("value",0);$("#idevio-slider-"+this.layout.qInfo.qId).slider("option","max",this.dimensionsToAnimate.length-1);var c=this.layout.qHyperCube.qDimensionInfo[0].qFallbackTitle;var b=this.dimensionsToAnimate[$("#idevio-slider-"+this.layout.qInfo.qId).slider("value")].qText||this.dimensionsToAnimate[$("#idevio-slider-"+this.layout.qInfo.qId).slider("value")].qNum;this.setLabelAndText(c,b)};a.prototype.start=function(){if(this.isPaused){$("#idevio-animator-start-button-"+this.layout.qInfo.qId).hide();$("#idevio-animator-pause-button-"+this.layout.qInfo.qId).show();this.isPaused=false;if(!this.dimensionsToAnimate||this.dimensionsToAnimate.length<1){this.requestData()}else{this.animate(this.dimensionsToAnimate)}}else{return}};a.prototype.pause=function(){$("#idevio-animator-start-button-"+this.layout.qInfo.qId).show();$("#idevio-animator-pause-button-"+this.layout.qInfo.qId).hide();this.isPaused=true;clearInterval(this.intervalId)};a.prototype.removeUI=function(){$("#idevio-animator-main-"+this.layout.qInfo.qId).remove()};a.prototype.updateUI=function(){var b=$("#idevio-animator-value-"+this.layout.qInfo.qId);b.css("font-size",36);b.show();while((b.width()>(this.$element.width()-54))||(b.height()>(this.$element.height()-$("#idevio-animator-controls-"+this.layout.qInfo.qId).height()))){if(parseInt(b.css("font-size"))<=8){b.hide();break}else{b.css("font-size",parseInt(b.css("font-size"))-1)}}};a.prototype.animate=function(b){if(!this.dimensionsToAnimate||this.dimensionsToAnimate.length<1){this.dimensionsToAnimate=b}var c=this;this.intervalId=setInterval(function(){if($(".qv-mode-edit").length===1){c.pause()}if(!c.isPaused&&c.dimensionsToAnimate.length>1){c.toSelect=c.toSelect||[];var e=c.dimensionsToAnimate[c.index];var d=c.layout.qHyperCube.qDimensionInfo[0].qFallbackTitle;$("#idevio-slider-"+c.layout.qInfo.qId).slider("value",c.index);c.setLabelAndText(d,e.qText||e.qNum);if(c.layout.animator.aggr&&c.layout.animator.steps===0){c.toSelect.push(e.qElemNumber)}else{c.toSelect=[e.qElemNumber]}c.backendApi.selectValues(0,c.toSelect,false);if(c.index>=c.dimensionsToAnimate.length-1){c.index=0;c.toSelect=[];if(!c.layout.animator.loop){c.pause()}}else{if(c.layout.animator.steps>1&&c.layout.animator.steps<c.dimensionsToAnimate.length){c.index+=Math.floor(c.dimensionsToAnimate.length/c.layout.animator.steps);if(c.index>(c.dimensionsToAnimate.length-1)){c.index=0;if(!c.layout.animator.loop){c.pause()}}}else{c.index++}}}},this.layout.animator.intervalTime)};a.prototype.getDimensionValues=function(b){var d=[];var e=b[0].qMatrix;for(var c=0;c<e.length;c++){d.push(e[c][0])}return d};a.prototype.requestData=function(b){var d=0;var e=this;var c=function(g,f){e.backendApi.getData(g).then(function(h){f.push(h[0]);d+=h[0].qArea.qHeight;if(d>=e.backendApi.getRowCount()){if(b){e.dimensionsToAnimate=e.getDimensionValues(f);e.createUI()}else{e.dimensionsToAnimate=e.getDimensionValues(f);e.resetSlider()}}else{g[0].qTop+=g[0].qHeight;g[0].qHeight=Math.min(e.backendApi.getRowCount()-g[0].qTop,1000);c(g,f)}})};c([{qTop:0,qLeft:0,qWidth:10,qHeight:Math.min(this.backendApi.getRowCount(),1000)}],[])};return a});