define(["qlik","underscore","jquery","css!./VizlibTextObject.css","ng!$q"],function(a,b,c,d,e){"use strict";c("<style>").html(d).appendTo("head");var f=a.currApp(),g=["#b0afae","#7b7a78","#545352","#4477aa","#7db8da","#b6d7ea","#46c646","#f93f17","#ffcf02","#276e27","#ffffff","#000000"],h=function(){var a=e.defer();return f.getList("BookmarkList",function(c){var d=[];return b.each(c.qBookmarkList.qItems,function(a){d.push({value:a.qInfo.qId,label:a.qData.title})}),a.resolve(d)}),a.promise},i=function(){var a=e.defer();return f.getAppObjectList(function(c){var d=[],e=b.sortBy(c.qAppObjectList.qItems,function(a){return a.qData.rank});return b.each(e,function(a){d.push({value:a.qInfo.qId,label:a.qMeta.title})}),a.resolve(d)}),a.promise};return{initialProperties:{action:[]},definition:{type:"items",component:"accordion",items:{Actions:{label:"Actions",type:"items",items:{Action:{ref:"action",label:"Action",type:"array",itemTitleRef:function(a){return a.name},allowAdd:!0,allowRemove:!0,addTranslation:"Add Action",items:{actionselection:{ref:"name",label:function(a){return"Pick Action"},type:"string",component:"dropdown",options:[{value:"Selection in Field",label:"Selection in Field"},{value:"Select Excluded",label:"Select Excluded"},{value:"Select Possible",label:"Select Possible"},{value:"Select Alternative",label:"Select Alternative"},{value:"Forward",label:"Forward"},{value:"Back",label:"Back"},{value:"Lock Field",label:"Lock Field"},{value:"Lock All",label:"Lock All"},{value:"Unlock Field",label:"Unlock Field"},{value:"Unlock All",label:"Unlock All"},{value:"Unlock and Clear All",label:"Unlock and Clear All"},{value:"Clear All",label:"Clear All"},{value:"Clear Field",label:"Clear Field"},{value:"Activate Next Sheet",label:"Activate Next Sheet"},{value:"Activate Sheet",label:"Activate Sheet"},{value:"Activate Previous Sheet",label:"Activate Previous Sheet"},{value:"Apply Bookmark",label:"Apply Bookmark"},{value:"Create Bookmark",label:"Create Bookmark"},{value:"Open URL",label:"Open URL"},{value:"Set Variable",label:"Set Variable"},{value:"Reload App",label:"Reload App"}]},actionfield:{ref:"field.name",label:"Field",type:"string",expression:"optional",show:function(a){return"Selection in Field"==a.name||"Lock Field"==a.name||"Clear Field"==a.name||"Select Excluded"==a.name||"Select Possible"==a.name||"Select Alternative"==a.name||"Unlock Field"==a.name}},actionfieldvalue:{ref:"field.value",label:"Field Value",type:"string",expression:"optional",show:function(a){return"Selection in Field"==a.name}},sheetid:{ref:"sheet.id",label:"Sheet Name",type:"strings",component:"dropdown",options:function(){return i().then(function(a){return a})},show:function(a){return"Activate Sheet"==a.name}},bookmarkid:{ref:"bookmark.id",label:"Bookmark ID",type:"string",component:"dropdown",options:function(){return h().then(function(a){return a})},show:function(a){return"Apply Bookmark"==a.name}},bookmarktitle:{ref:"bookmark.title",label:"Bookmark Title",type:"string",expression:"optional",show:function(a){return"Create Bookmark"==a.name}},bookmarkdesc:{ref:"bookmark.desc",label:"Bookmark Description",type:"string",component:"textarea",show:function(a){return"Create Bookmark"==a.name},defaultValue:""},URL:{ref:"url.url",label:"URL",type:"string",expression:"optional",show:function(a){return"Open URL"==a.name},defaultValue:""},URLSW:{ref:"url.samewindow",label:"Open in same window",type:"boolean",show:function(a){return"Open URL"==a.name},defaultValue:!1},variablename:{ref:"variable.name",label:"Variable",type:"string",expression:"optional",show:function(a){return"Set Variable"==a.name}},variablevalue:{ref:"variable.value",label:"Value",type:"string",expression:"optional",show:function(a){return"Set Variable"==a.name}}}}}},settings:{uses:"settings",type:"items",items:{Text:{ref:"text",label:"Text",type:"string",expression:"optional",defaultValue:"This is a sample text"},Font:{ref:"font",label:"Font",type:"items",items:{fontColorPicker:{label:"Font Color",component:"color-picker",ref:"fontColorPicker",change:function(a){a.fontcolor=g[a.fontColorPicker]},type:"integer",defaultValue:3},fontcolor:{ref:"fontcolor",type:"string",expression:"optional",defaultValue:"#000"},fontsize:{ref:"fontsize",label:"Size",type:"integer",defaultValue:33},fontstyle:{ref:"fontstyle",label:"Font style",type:"string",component:"dropdown",options:[{value:"standard",label:"Standard"},{value:"bold",label:"Bold"},{value:"italic",label:"Italic"},{value:"italicbold",label:"Italic Bold"}],defaultValue:"standard"},fontfamily:{label:"Font Family",type:"string",ref:"fontfamily",component:"dropdown",options:[{value:'"QlikView Sans", sans-serif',label:'"QlikView Sans", sans-serif'},{value:"LUI icons",label:"LUI Icons"},{value:"Georgia",label:"Georgia"},{value:"Times New Roman",label:"Times New Roman"},{value:"Arial",label:"Arial"},{value:"Comic Sans MS",label:"Comic Sans MS"},{value:"custom",label:"Define your own"}]},customfontfamily:{label:"Define your own font family",type:"string",ref:"customfontfamily",defaultValue:"<Type in your Font Name>",show:function(a){return"custom"==a.fontfamily}},dropshadow:{ref:"dropshadow",label:"Drop Shadow",type:"boolean",defaultValue:!1},underline:{ref:"underline",label:"Underline",type:"boolean",defaultValue:!1}}},Layout:{ref:"layout",label:"Layout",type:"items",items:{horizontalalignment:{label:"Horizontal Alignment",ref:"horizontalalignment",component:"dropdown",options:[{value:"left",label:"Left"},{value:"center",label:"Center"},{value:"right",label:"Right"}],defaultValue:"left"}}},Background:{ref:"background",label:"Background",type:"items",items:{backgroundtype:{type:"string",component:"buttongroup",ref:"bgtype",options:[{value:"color",label:"Color",tooltip:"Choose to pick a color"},{value:"image",label:"Image",tooltip:"Choose to upload image"},{value:"url",label:"URL",tooltip:"Embed URL"}],defaultValue:"color"},BGColorPicker:{label:"Background Color Color",component:"color-picker",ref:"BGColorPicker",change:function(a){a.backgroundcolor=g[a.BGColorPicker]},type:"integer",defaultValue:3,show:function(a){return"color"==a.bgtype}},backgroundcolor:{ref:"backgroundcolor",type:"string",defaultValue:"#fff",show:function(a){return"color"==a.bgtype}},backgroundimage:{label:"Image",component:"media",ref:"bgimage",layoutRef:"bgimage",type:"string",show:function(a){return"image"==a.bgtype}},imagestretch:{label:"Image Stretch",type:"string",ref:"imagestretch",component:"dropdown",options:[{value:"nostretch",label:"No Stretch"},{value:"fill",label:"Fill"},{value:"keepaspect",label:"Keep Aspect"},{value:"fillwithaspect",label:"Fill with Aspect"}],defaultValue:"nostretch",show:function(a){return"image"==a.bgtype}},backgroundtransparency:{type:"number",component:"slider",label:"Transparency",ref:"backgroundtransparency",min:0,max:1,step:.01,defaultValue:1,show:function(a){return"url"!=a.bgtype}},iframeurl:{ref:"iframeurl",label:"URL",type:"string",defaultValue:"http://",show:function(a){return"url"==a.bgtype}}}},About:{ref:"about",label:"About",type:"items",items:{Author:{label:"Vizlib",component:"text"},eMail:{label:"eMail: info@Vizlib.co.uk",component:"text"},Version:{label:"Version: v1.2",component:"text"}}}}}}},snapshot:{canTakeSnapshot:!1},paint:function(b,c){var f=(b.width(),b.height(),"id_"+c.qInfo.qId),g=c.text,h=c.fontcolor,i=c.fontsize,j=c.fontfamily,k=c.customfontfamily,l=c.fontstyle,m=c.dropshadow,n=c.underline,o=c.horizontalalignment,p=c.verticalalignment,q=c.bgtype,r=c.backgroundcolor,s=c.backgroundtransparency,t=c.bgimage,u=c.imagestretch,v=c.iframeurl,w=c.action,x="<div id="+f+"></div>";switch(b.html(x),b.find("#"+f).css("color",h),b.find("#"+f).css("font-size",i),l){case"bold":b.find("#"+f).css("font-weight","bold");break;case"italic":b.find("#"+f).css("font-style","italic");break;case"italicbold":b.find("#"+f).css("font-style","italic"),b.find("#"+f).css("font-weight","bold")}switch(j){case"custom":b.find("#"+f).css("font-family",k);break;default:b.find("#"+f).css("font-family",j)}switch(n&&b.find("#"+f).css("text-decoration","underline"),m&&b.find("#"+f).css("text-shadow","1px 1px #000000"),o){case"left":b.find("#"+f).css("text-align","left");break;case"center":b.find("#"+f).css("text-align","center");break;case"right":b.find("#"+f).css("text-align","right")}switch(p){case"top":b.find("#"+f).css("vertical-align","top");break;case"centered":b.find("#"+f).css("vertical-align","middle");break;case"bottom":b.find("#"+f).css("vertical-align","bottom")}if("color"==q)b.find("#"+f).css("background-color",r);else if("url"==q)g+='<iframe src="'+v+'" width="100%" height="100%" />';else switch(b.find("#"+f).css("background-image","url("+t+")"),b.find("#"+f).css("background-repeat","no-repeat"),u){case"fill":b.find("#"+f).css("background-size","100% 100%");break;case"keepaspect":b.find("#"+f).css("background-size","contain");break;case"fillwithaspect":b.find("#"+f).css("background-size","cover")}if(b.find("#"+f).css("border-radius","0px"),b.find("#"+f).css("opacity",s),b.find("#"+f).css("height","100%"),b.find("#"+f).html(g),0!=w.length){b.find("#"+f).css("cursor","pointer");var y=a.currApp();b.find("#"+f).click(function(){w.forEach(function(b){switch(b.name){case"Selection in Field":var c=b.field.name,d=b.field.value;c&&d&&y.field(c).selectMatch(d,!1);break;case"Lock Field":var c=b.field.name;c&&y.field(c).lock();break;case"Select Excluded":var c=b.field.name;c&&y.field(c).selectExcluded(!1);break;case"Select Alternative":var c=vActionField;c&&y.field(c).selectAlternative(!1);break;case"Select Possible":var c=b.field.name;c&&y.field(c).selectPossible(!1);break;case"Forward":y.forward();break;case"Back":y.back();break;case"Lock All":y.lockAll();break;case"Unlock Field":var c=b.field.name;c&&y.field(c).unlock();break;case"Unlock All":y.unlockAll();break;case"Unlock and Clear All":y.clearAll(!0);break;case"Clear All":y.clearAll();break;case"Clear Field":var c=b.field.name;c&&y.field(c).clear();break;case"Activate Next Sheet":a.navigation.nextSheet();break;case"Activate Sheet":var e=b.sheet.id;a.navigation.gotoSheet(e);break;case"Activate Previous Sheet":a.navigation.prevSheet();break;case"Apply Bookmark":var f=b.bookmark.id;f&&y.bookmark.apply(f);break;case"Create Bookmark":var g=b.bookmark.title,h=b.bookmark.desc;g&&h&&y.bookmark.create(g,h);break;case"Open URL":var i=b.url.url,j=b.url.samewindow?"_self":"_blank";i&&j&&window.open(i,j);break;case"Set Variable":var k=b.variable.name,d=b.variable.value;k&&d&&y.variable.setContent(k,d);break;case"Reload App":y.doReload()}})})}}}});